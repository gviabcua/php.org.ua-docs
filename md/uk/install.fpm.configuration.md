Налаштування

-   [« Установка](install.fpm.install.html)
    
-   [Установка модулей PECL »](install.pecl.html)
    
-   [PHP Manual](index.html)
    
-   [Менеджер процессов FastCGI (FPM)](install.fpm.html)
    
-   Налаштування
    

## Налаштування

FPM використовує синтаксис php.ini для файлу конфігурації php-fpm.conf і файлів конфігурації пулів.

### Список глобальних директив php-fpm.conf

`pid` string

Шлях до файлу PID. Типово: none.

`error_log` string

Шлях до файлу журналу помилок. За замовчуванням: `#INSTALL_PREFIX#/log/php-fpm.log`. Якщо встановлено як "syslog", логування буде здійснюватися в syslogd, а не в локальний файл.

`log_level` string

Рівень журналування помилок. Можливі значення: alert, error, warning, notice, debug. Типово: notice.

`log_limit` int

Обмежити журналування для журнальних ліній, що дозволяє записувати повідомлення довжиною понад 1024 символи без упаковки (wrapping). Стандартне значення: 1024. Доступно з PHP 7.3.0.

`log_buffering` bool

Експериментальне журналування без додаткової буферизації. Значення за промовчанням: yes. Доступно з PHP 7.3.0.

`syslog.facility` string

Використовується для вказівки, який тип програм логуватиме повідомлення. Типово: daemon.

`syslog.ident` string

Передує будь-якому повідомленню. Якщо у вас запущено кілька екземплярів FPM, ви можете змінити значення за промовчанням на те, яке вам потрібно. Типово: php-fpm.

`emergency_restart_threshold` int

При цьому кількість робочих процесів, завершених із SIGSEGV або SIGBUS за проміжок часу, встановлений `emergency_restart_interval` FPM буде перезавантажено. Значення 0 означає 'Off' (вимкнено). Типово: 0 (Off).

`emergency_restart_interval` [mixed](language.types.declarations.html#language.types.declarations.mixed)

Інтервал часу, що використовується `emergency_restart_interval`, щоб визначити, коли FPM буде м'яко перезавантажено. Це корисно для запобігання випадковим пошкодженням загальної пам'яті прискорювача (accelerator). Доступні одиниці виміру: s(секунди), m(хвилини), h(години), або d(дні). Одиниця виміру за замовчуванням: секунди. Стандартне значення: 0 (Off).

`process_control_timeout` [mixed](language.types.declarations.html#language.types.declarations.mixed)

Час, протягом якого дочірні процеси чекають на сигнали майстер-процесу. Доступні одиниці вимірювання: s(секунди), m(хвилини), h(години) або d(дні). Одиниця виміру за замовчуванням: секунди. Значення за промовчанням: 0.

`process.max` int

Максимальна кількість процесів може породити FPM. Це зроблено для того, щоб контролювати глобальну кількість процесів, коли використовується великий пул динамічного PM. Використовуйте з обережністю. Типово: 0.

`process.priority` int

Вказує пріоритет (Unix nice(2)) майстер-процесу (тільки якщо встановлено). Приймає значення від -19 (максимальний пріоритет) до 20 (мінімальний). За замовчуванням: не встановлено.

`daemonize` bool

Запустити FPM у фоновому режимі. Встановіть значення 'no', щоб запустити FPM у диспетчері для налагодження. Типово: yes.

`rlimit_files` int

Встановлює rlimit відкритих файлових дескрипторів для майстер-процесу. Типово: Значення, визначене системою.

`rlimit_core` int

Встановлює rlimit максимального розміру ядра для майстер-процесу. Типово 0.

`events.mechanism` string

Вказує, який механізм дії буде використаний FPM. Можливі такі варіанти: select, pool, epoll, kqueue (BSD), порт (Solaris). За промовчанням: не встановлено (автовизначення).

`systemd_interval` int

Якщо FPM зібраний з інтеграцією з systemd, вказує інтервал, в секундах між сповіщеннями systemd про свій стан. Щоб вимкнути, встановіть 0. За замовчуванням: 10.

### Перелік директив для пулів.

За допомогою FPM можна запускати кілька пулів процесів з різними налаштуваннями. Ці параметри можуть бути передані пулу.

`listen` string

Адреса, яка прийматиме FastCGI-запити. Синтаксис: 'ip.add.re.ss:port', 'port', '/path/to/unix/socket'. Ця опція є обов'язковою для кожного пулу.

`listen.backlog` int

Встановлює listen(2) backlog. Значення `-1` означає максимум на системах BSD. Значення за замовчуванням: `-1` (FreeBSD або OpenBSD) або `511`. (Linux та інші платформи).

`listen.allowed_clients` string

Список адрес IPv4 або IPv6 клієнтів FastCGI, яким дозволено підключення. Еквівалент змінної оточення FCGIWEBSERVERADDRS в оригінальному PHP FastCGI (5.2.2+). Має сенс лише з TCP-сокетом. Кожна адреса має бути розділена комою. Якщо залишити це значення порожнім, з'єднання прийматимуться з будь-якої IP-адреси. Значення за замовчуванням: не встановлено (приймається будь-яка IP-адреса).

`listen.owner` string

Встановлює права для unix-сокету, якщо вони використовуються. У Linux для дозволу з'єднань до веб-сервера, мають бути встановлені права на читання/запис. Багато заснованих на BSD-системах можливість з'єднання залежить від прав доступу. Значення за промовчанням: використовується користувач і група, від імені якої запущено сервер, встановлено режим 0660.

`listen.group` string

Дивіться `listen.owner`

`listen.mode` string

Дивіться `listen.owner`

`listen.acl_users` string

Якщо підтримується список керування доступом (ACL) POSIX, можна налаштувати його за допомогою цієї опції. Якщо поставлено, то `listen.owner` і `listen.group` будуть проігноровані. Значення задається списком імен, розділених комою.

`listen.acl_groups` string

Дивіться `listen.acl_users`. Значення визначається списком імен груп, розділених комою.

`user` string

Unix-користувач FPM-процесів. Цей параметр є обов'язковим.

`group` string

Unix-група FPM-процесів. Якщо не встановлено, група за промовчанням дорівнює імені користувача.

`pm` string

Вибір того, як менеджер процесів контролюватиме створення дочірніх процесів. Можливі значення: `static` `ondemand` `dynamic`. Цей параметр є обов'язковим.

`static` - фіксована кількість дочірніх процесів (`pm.max_children`

`ondemand` - Число процесів, що породжуються на вимогу (коли з'являються запити, на відміну від опції dynamic, коли стартує певна кількість процесів, що дорівнює `pm.start_servers`, разом із запуском служби.

`dynamic` - число дочірніх процесів, що динамічно змінюється, задається на підставі наступних директив: `pm.max_children` `pm.start_servers` `pm.min_spare_servers` `pm.max_spare_servers`

`pm.max_children` int

Число дочірніх процесів, які будуть створені, коли `pm` встановлений в `static`, або ж максимальна кількість процесів, які будуть створені, коли `pm` встановлений в `dynamic`. Цей параметр є обов'язковим.

Цей параметр встановлює обмеження кількості одночасних запитів, які будуть обслуговуватися. Еквівалент директиви ApacheMaxClients з mpmprefork та змінної оточення середовища PHPFCGICHILDREN в оригінальному PHP FastCGI.

`pm.start_servers` int

Число дочірніх процесів, створюваних під час запуску. Використовується тільки коли `pm` встановлений в `dynamic`. Значення за замовчуванням: minspareservers + (maxspareservers - minspareservers)/2.

`pm.min_spare_servers` int

Бажана мінімальна кількість неактивних процесів сервера. Використовується тільки коли `pm` встановлено в `dynamic`. З іншого боку, це обов'язковий параметр у разі.

`pm.max_spare_servers` int

Бажана максимальна кількість неактивних процесів сервера. Використовується тільки коли `pm` встановлений в `dynamic`. З іншого боку, це обов'язковий параметр у разі.

`pm.max_spawn_rate` int

Кількість одночасних породжень дочірніх процесів. Використовується лише тоді, коли параметр `pm` встановлено значення `dynamic`. Значення за замовчуванням: 32

`pm.process_idle_timeout` [mixed](language.types.declarations.html#language.types.declarations.mixed)

Число секунд, по закінченню яких процес, що простоює, буде завершено. Використовується лише якщо `pm` встановлено як `ondemand`. Допустимі одиниці: s(econds)(за замовчуванням), m(inutes), h(ours) або d(ays). Типово: 10s.

`pm.max_requests` int

Число запитів дочірнього процесу, після якого процес буде перезапущено. Це корисно для запобігання витоку пам'яті під час використання сторонніх бібліотек. Для нескінченної обробки запитів вкажіть '0'. Еквівалент PHPFCGIMAXREQUESTS. Значення за промовчанням: 0.

`pm.status_listen` string

Адреса, за якою прийматиметься запит стану FastCGI. Створює новий невидимий пул, який може самостійно обробляти запити. Корисно, якщо основний пул зайнятий запитами, що довго виконуються, так як все ще можна отримати [страницу состояния FPM](fpm.status.html) до завершення тривалих запитів. Синтаксис такий самий, як і для директиви [listen](install.fpm.configuration.html#listen). Стандартне значення: none.

`pm.status_path` string

Посилання, по якому можна переглянути [страницу состояния FPM](fpm.status.html). Значення має починатися зі сліша (/). Якщо значення не встановлено, сторінка статусу не відображатиметься. Стандартне значення: none.

`ping.path` string

Посилання на ping-сторінку FPM моніторингу. Якщо значення не встановлено, ping-сторінка не відображатиметься. Може бути використане для тестування ззовні, щоб переконатися, що FPM живий та відповідає. Зверніть увагу, що значення має починатися з косої межі (/).

`ping.response` string

Ця директива може бути використана для налаштування відповіді на ping-запит. Відповідь формується як text/plain з кодом відповіді 200. Значення за замовчуванням: pong.

`process.priority` int

Вказує пріоритет nice(2) для працюючого процесу (тільки якщо заданий). Значення від -19 (найвищий пріоритет) до 20 (найнижчий). Значення за замовчуванням: не встановлено.

`process.dumpable` bool

Встановити прапор процесу dumpable (PRSETDUMPABLE prctl), навіть якщо користувач процесу або група відрізняється від користувача майстер-процесу. Це дозволяє створювати дамп ядра процесу та виконати ptrace процесу для користувача пула. Значення за промовчанням: no. Доступно з PHP 7.0.29, 7.1.17 та 7.2.5.

`prefix` string

Задає префікс для обчислення шляху

`request_terminate_timeout` [mixed](language.types.declarations.html#language.types.declarations.mixed)

Час очікування на обслуговування одного запиту, після чого робочий процес буде завершено. Цей варіант слід використовувати, коли опція 'maxexecutiontime' в php.ini не зупиняє виконання скрипту з якихось причин. Значення '0' означає 'вимкнено'. Доступні одиниці виміру: s(econds), m(inutes), h(ours) або d(ays). Значення за промовчанням: 0.

`request_terminate_timeout_track_finished` bool

Час очікування, встановлений за допомогою [request\_terminate\_timeout](install.fpm.configuration.html#request-terminate-timeout), не включається після [fastcgi\_finish\_request](function.fastcgi-finish-request.html) або коли програма завершена та викликаються внутрішні функції завершення роботи. Ця директива дозволить беззастережно застосовувати обмеження часу очікування навіть у таких випадках. Стандартне значення: ні, починаючи з версії PHP 7.3.0.

`request_slowlog_timeout` [mixed](language.types.declarations.html#language.types.declarations.mixed)

Час очікування на обслуговування одного запиту, після чого PHP backtrace буде збережений у файл 'slowlog'. Значення '0' означає 'вимкнено'. Доступні одиниці виміру: s(econds), m(inutes), h(ours) або d(ays). Значення за промовчанням: 0.

`request_slowlog_trace_depth` int

Глибина трасування стека журналу slowlog. Стандартне значення: 20, починаючи з PHP 7.2.0.

`slowlog` string

Лог файл для повільних запитів. Значення за замовчуванням: `#INSTALL_PREFIX#/log/php-fpm.log.slow`

`rlimit_files` int

Встановлює ліміт дескрипторів відкритих файлів rlimit для дочірніх процесів у цьому пулі. Значення за промовчанням: визначається значенням системи.

`rlimit_core` int

Встановлює максимальну кількість використовуваних ядер rlimit для дочірніх процесів у цьому пулі. Можливі значення: 'unlimited' або ціле число більше або рівне 0. Значення за замовчуванням: визначається значенням системи.

`chroot` string

Директорія chroot оточення у старті. Це значення має визначити як абсолютний шлях. Якщо значення не встановлено, chroot не використовується.

`chdir` string

Chdir змінює поточну директорію у старті. Це значення має визначити як абсолютний шлях. Значення за замовчуванням: поточна директорія або при використанні chroot.

`catch_workers_output` bool

Перенаправлення STDOUT і STDERR робочого процесу на головний лог помилок. Якщо не встановлено, STDOUT і STDERR будуть перенаправлені в /dev/null відповідно до специфікації FastCGI. Значення за промовчанням: no.

`decorate_workers_output` bool

Увімкніть оформлення виходу (output decoration) для виведення worker-процесу коли опція [catch\_workers\_output](install.fpm.configuration.html#catch-workers-output) включено. Значення за промовчанням: yes. Доступно з PHP 7.3.0.

`clear_env` bool

Очищає оточення у worker-процесах FPM. Запобігає потраплянню довільних змінних оточення до worker-процесів FPM, очищаючи оточення у worker-процесах до того, як змінні оточення, зазначені в цій конфігурації пула будуть додані. Типово: Yes.

`security.limit_extensions` string

Обмежує модулі, які FPM буде аналізувати. Це може запобігти помилкам конфігурації на стороні веб-сервера. Ви повинні обмежити FPM тільки розширеннями .php для запобігання виконання PHP-коду зловмисниками іншими розширеннями. За замовчуванням: .php .phar

`apparmor_hat` string

Якщо AppArmor увімкнено, дозволяє змінити шапку. Значення за замовчуванням: не встановлено

`access.log` string

Лог файл доступу. Значення за замовчуванням: не встановлено

`access.format` string

Формат файлу лог-файлу. Значення за замовчуванням: `"%R - %u %t \"%m %r\" %s"`

**Допустимі значення**

| Заполнитель | Описание |
| --- | --- |
| **`%C`** | %CPU |
| **`%d`** | тривалість µs |
| **`%e`** | fastcgi env |
| **`%f`** | скрипт |
| **`%l`** | довжина вмісту |
| **`%m`** | метод |
| **`%M`** | пам'ять |
| **`%n`** | назва пула |
| **`%o`** | висновок заголовка |
| **`%p`** | PID |
| **`%q`** | рядок запиту |
| **`%Q`** | GLUE між %q та %r |
| **`%r`** | URI запиту |
| **`%R`** | віддалена IP-адреса |
| **`%s`** | статус |
| **`%T`** | час |
| **`%t`** | час |
| **`%u`** | віддалений користувач |

Можна передати додаткові змінні оточення та оновити налаштування PHP для певного пулу. Для цього вам необхідно додати такі параметри до файлу налаштування пулу.

**Приклад #1 Передача змінних оточення та налаштувань PHP пулу**

envHOSTNAME = $HOSTNAME envPATH = /usr/local/bin:/usr/bin:/bin envTMP = /tmp envTMPDIR = /tmp envTEMP = /tmp

phpadminvaluesendmailpath = /usr/sbin/sendmail -t -i -f [www@my.domain.com](mailto:www@my.domain.com)phpflagdisplayerrors = off phpadminvalueerrorlog = /var/log/fpm-php.[www.log](http://www.log)phpadminflaglogerrors = on phpadminvaluememorylimit = 32M

Налаштування PHP, передані через `php_value` або `php_flag` перезапишуть їхні попередні значення. Будь ласка, зверніть увагу, що визначення [disable\_functions](ini.core.html#ini.disable-functions) або [disable\_classes](ini.core.html#ini.disable-classes) не перезаписуватимуть раніше визначені в php.ini значення, а додадуть нові значення.

Налаштування, визначені через `php_admin_value` і `php_admin_flag`, не можуть бути перезаписані через [ini\_set()](function.ini-set.html)

Установки PHP можна інсталювати через веб-сервер.

**Приклад #2 Встановлення налаштувань PHP у nginx.conf**

set $phpvalue "pcre.backtracklimit=424242"; set $phpvalue "$phpvalue n pcre.recursionlimit=99999"; fastcgiparam PHPVALUE $phpvalue;

fastcgiparam PHPADMINVALUE "openbasedir=/var/www/htdocs";

**Застереження**

Оскільки ці налаштування передаються в php-fpm як FastCGI-заголовки, php-fpm не повинен бути прив'язаний до загальнодоступної адреси світу. В іншому випадку будь-хто зможе змінити налаштування PHP. Дивіться також [listen.allowed\_clients](install.fpm.configuration.html#listen-allowed-clients)

> **Зауваження**: Пули не є механізмом безпеки, тому що вони не забезпечують повного поділу; наприклад, всі пули будуть використовувати один екземпляр OPcache.