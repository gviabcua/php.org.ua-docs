- [« restore_exception_handler](function.restore-exception-handler.md)
- [set_exception_handler »](function.set-exception-handler.md)

- [PHP Manual](index.md)
- [Функції обробки помилок](ref.errorfunc.md)
- Задає користувальницький обробник помилок

#set_error_handler

(PHP 4 \>= 4.0.1, PHP 5, PHP 7, PHP 8)

set_error_handler — Задає користувальницький обробник помилок

### Опис

**set_error_handler**(?[callable](language.types.callable.md)
`$callback`, int `$error_levels` = **`E_ALL`**):
?[callable](language.types.callable.md)

Задає функцію користувача (`callback`), як обробник помилок в
скрипт.

Ця функція використовується для визначення власного обробника помилок
часу виконання сценарію. Наприклад, якщо потрібно очистити
дані/файли, коли сталася критична помилка, або якщо потрібно
переключити тип помилки, виходячи з якихось умов (використовуючи функцію
[trigger_error()](function.trigger-error.md)).

Важливо пам'ятати, що стандартний обробник помилок PHP не буде
обробляти ніякі типи помилок, визначені в `error_levels`, поки
callback-функція не поверне **`false`**. Користувальницький обробник
буде викликатися за будь-якої помилки, незалежно від налаштувань, заданих
функцією
[error_reporting](errorfunc.configuration.md#ini.error-reporting).

Також важливо пам'ятати, що на совісті обробника лежить виклик функції
[die()](function.die.md) у разі потреби. Якщо відбувається
повернення з обробника помилок, керування передається наступному
виразу, що стоїть за тим, що викликало помилку.

Помилки таких типів не можуть бути оброблені користувачем:
**`E_ERROR`**, **`E_PARSE`**, **`E_CORE_ERROR`**, **`E_CORE_WARNING`**,
**`E_COMPILE_ERROR`**, **`E_COMPILE_WARNING`** незалежно від того, де
вони були згенеровані і більшість помилок **`E_STRICT`**, що відбулися
у файлі, де викликана функція **set_error_handler()**.

Якщо помилки виникають до запуску скрипта (наприклад, поки файл
завантажується), користувальницький обробник не буде викликатися, якщо на
цей момент ще не зареєстрований.

### Список параметрів

`callback`
Якщо передано значення **`null`**, обробник скидається у стан
за замовчуванням. Інакше обробник є
callback-функцію з наступною сигнатурою:

handler(
int `$errno`,
string `$errstr`,
string `$errfile` = ?,
int `$errline` = ?,
array `$errcontext` = ?
): bool

`errno`
У перший аргумент `errno` буде передано рівень помилки у вигляді цілого
числа.

`errstr`
У другому аргументі `errstr` буде передано повідомлення про помилку у вигляді
рядки.

`errfile`
Якщо функція зворотного виклику приймає третій параметр `errfile`, то
його буде передано ім'я файлу, в якому відбулася помилка, у вигляді
рядки.

`errline`
Якщо функція зворотного дзвінка приймає четвертий параметр `errline`, то
у нього буде передано номер рядка, в якому сталася помилка, у вигляді
цілого числа.

`errcontext`
Якщо функція зворотного виклику приймає п'ятий параметр errcontext, то
у нього буде передано масив покажчиків на активну таблицю символів
точці, де сталася помилка. Іншими словами, `errcontext` буде
утримувати масив усіх змінних, що існують в області видимості, де
Виникла помилка. Користувальницькі обробники помилок не повинні змінювати
цей контекст.

**Увага**
Цей параметр оголошений *УСТАРШИМ* починаючи з PHP 7.2.0 і був *Видалений* в
PHP 8.0.0 Якщо у вашій функції цей параметр використовується і для нього немає
встановлено значення за замовчуванням, то при виклику функції обробника буде
видано помилку "too few arguments".

Якщо функція повертає **`false`**, керування передається вбудованому
обробнику помилок.

`error_levels`
Може використовуватися для завдання маски, відповідно до якої буде
викликатися `callback`, за аналогією з ini-настроюванням
[error_reporting](errorfunc.configuration.md#ini.error-reporting),
яка відповідає за те, які помилки будуть показані у звіті. Без цієї
маски `callback` буде викликатися для обробки всіх, що відбуваються
помилок, незалежно від налаштувань у
[error_reporting](errorfunc.configuration.md#ini.error-reporting).

### Значення, що повертаються

Повертає раніше визначений обробник помилок (якщо є) Якщо на
на даний момент використовується вбудований обробник, функція поверне
**`null`**. Якщо попередній певний обробник є методом
класу, функція поверне масив, що містить ім'я класу та ім'я методу.

### Список змін

| Версія | Опис                                                                                                                    |
| ------ | ----------------------------------------------------------------------------------------------------------------------- |
| 8.0.0  | Параметр errcontext був видалений і більше не передається в функцію обробки помилок.                                    |
| 7.2.0  | Параметр errcontext оголошений застарілим. Тепер при його використанні буде викликатись помилка рівня **E_DEPRECATED**. |

### Приклади

**Приклад #1 Обробка помилок за допомогою функцій **set_error_handler()** та
[trigger_error()](function.trigger-error.md)**

Приклад нижче демонструє обробку внутрішніх виключень шляхом виклику
помилок різних типів та їх обробки користувальницькою функцією:

` <?php// функция обработки ошибокfunction myErrorHandler($errno, $errstr, $errfile, $errline){    if (!(error_reporting() & $errno)) {        // Этот код ошибки не включён в error_reporting,        // так що нехай обробляються стандартним обробником помилок PHP        return false; }    // може потрібно екранування $errstr:    $errstr = htmlspecialchars($errstr); switch ($errno) {   case E_USER_ERROR:        echo "<b>Користувацька ПОМИЛКА</b> [$errno] $errstr<br />
";||   ||||||||||||||||||||
";        echo "Завершення роботи...<br />
";         exit(1);   case E_USER_WARNING:        echo "<b>Користувальне ПОПЕРЕДЖЕННЯ</b> [$errno] $
";        break;    case E_USER_NOTICE:        echo "<b>Користувачське ПОВІДОМЛЕННЯ</b> [$errno] $errstr<br
";        break;    default:        echo "Невідома помилка: [$errno] $errstr<br />
";        break;    }    /* Не запускаем внутренний обработчик ошибок PHP */    return true;}// функция для тестирования обработчика ошибокfunction scale_by_log($vect, $scale){    if (!is_numeric($scale) || $scale <= 0 ) {        trigger_error("log(x) для x <= 0 не определён, вы используете: scale = $scale", E_USER_ERROR);    }    if (!is_array($vect)) {        trigger_error("Некорректный входной вектор, пропущен массив значений ", E_USER_WARNING);        return null;    }    $temp = array();    foreach($vect as $pos => $value) {        if (!is_numeric($value)) {            trigger_error("Значение на позиции $pos не является числом , будет использован 0 (ноль)", E_USER_NOTICE);            $value = 0;        }        $temp[$pos] = log($scale) * $value;    }    return $temp;}// переключаемся на пользовательский обработчик$old_error_handler = set_error_handler ("myErrorHandler");// викликаємо кілька помилок, по-перше, визначимо масив з нечисловим елементомecho "vector a
";$a = array(2, 3, "foo", 5.5, 43.3, 21.11);print_r($a);// тепер створимо ще один масивecho "----
vector b - a notice (b = log(PI) * a)
";/* Значення на позиції $pos не є числом, буде використаний 0 (нуль)*/$b = scale_by_log($a, M_PI);print_r($b);// проблема, ми| -
vector c - a warning
";/* Некоректний вхідний вектор, пропущений масив значень */$c = scale_by_log("not array", 2.3);var_dump($c); // NULL// критична помилка  -
vector d - fatal error
";/* log(x) для x <= 0 не визначений, ви використовується: scale = $scale */$d = scale_by_log($a, -2.5); ?> `

Результатом виконання цього прикладу буде щось подібне:

vector a
Array
(
[0] => 2
[1] => 3
[2] => foo
[3] => 5.5
[4] => 43.3
[5] => 21.11
)
----
vector b - a notice (b = log(PI) * a)
<b>УВАГА користувача</b> [1024] Значення на позиції 2 не є числом, буде використано 0 (нуль)<br />
Array
(
[0] => 2.2894597716988
[1] => 3.4341896575482
[2] => 0
[3] => 6.2960143721717
[4] => 49.566804057279
[5] => 24.165247890281
)
----
vector c - a warning
<b>Користувацьке ПОПЕРЕДЖЕННЯ</b> [512] Некоректний вхідний вектор, пропущений масив значень<br />
NULL
----
vector d - fatal error
<b>Помилка користувача</b> [256] log(x) for x <= 0 не визначено, ви використовуєте: scale = -2.5<br />
Фатальна помилка у рядку 35 файлу trigger_error.php, PHP 5.2.1 (FreeBSD)<br />
Завершення роботи...<br />

### Дивіться також

- [ErrorException](class.errorexception.md)
- [error_reporting()](function.error-reporting.md) - Задає, які
помилки PHP потраплять у звіт
- [restore_error_handler()](function.restore-error-handler.md) -
Відновлює попередній обробник помилок
- [trigger_error()](function.trigger-error.md) - Викликає
помилку користувача/попередження/повідомлення
- [Константи рівнів помилок](errorfunc.constants.md)
