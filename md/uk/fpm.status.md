Сторінка стану

-   [« Спостережуваність](fpm.observability.html)
    
-   [Функції FPM »](ref.fpm.html)
    
-   [PHP Manual](index.html)
    
-   [Спостережуваність](fpm.observability.html)
    
-   Сторінка стану
    

## Сторінка стану

На цій сторінці представлена ​​інформація про налаштування та зміст сторінки стану FPM. Дивіться також опис функції [fpmgetstatus()](function.fpm-get-status.html)

### Налаштування

Сторінку стану FPM можна увімкнути шляхом встановлення параметра конфігурації [pm.statuspath](install.fpm.configuration.html#pm.status-path) у пулі FPM конфігурації.

**Застереження**

З метою безпеки сторінка стану FPM повинна бути обмежена внутрішніми запитами або відомими IP-адресами клієнтів, оскільки сторінка показує URL-адресу запиту та інформацію про доступні ресурси.

Залежно від конфігурації веб-сервера може знадобитися налаштувати веб-сервер так, щоб дозволяти запити безпосередньо до цього шляху, минаючи будь-які PHP скрипти. Приклад конфігурації для Apache з FPM, що слухає UDS і `pm.status_path`, встановленим на `/fpm-status` буде виглядати так:

Order Allow,Deny Allow from 127.0.0.1 ProxyPass "unix:/var/run/php-fpm.sock|fcgi://localhost/fpm-status"

Після перезавантаження або перезапуску як FPM, так і веб-сервера сторінка стану буде доступна з браузера (за умови, що запит надходить з дозволеної IP-адреси, якщо було настроєно обмеження IP-адрес).

### Параметри запиту

Формат виведення сторінки стану може бути змінено шляхом вказівки одного з наступних параметрів запиту:

-   `html`
-   `json`
-   `openmetrics`
-   `xml`

Додаткову інформацію також можна повернути за допомогою параметра запиту `full`

Приклади URL-адрес сторінок стану:

-   `https://localhost/fpm-status` - Короткий висновок у текстовому форматі за замовчуванням
-   `https://localhost/fpm-status?full` - Повний висновок у текстовому форматі за замовчуванням
-   `https://localhost/fpm-status?json` - Короткий висновок у форматі JSON
-   `https://localhost/fpm-status?html&full` - Повний висновок у форматі HTML

### Відображувана інформація

Значення дати/часу використовують формат тимчасової мітки UNIX у JSON та XML, інакше вони використовують формат, що призводить до наступного прикладу дати: `"03/Jun/2021:07:21:46 +0100"`

**Основна інформація - Завжди відображається на сторінці стану**

| Параметр             | Описание                                                                                                                  |
|----------------------|---------------------------------------------------------------------------------------------------------------------------|
| pool                 | Ім'я пулу процесів FPM.                                                                                                   |
| process manager      | Тип менеджера процесу - статичний (статичний), динамічний (динамічний) або ondemand (на вимогу).                          |
| start time           | Дата/час останнього запуску пулу процесів.                                                                                |
| start since          | Час за секунди з моменту останнього запуску пулу процесів.                                                                |
| accepted conn        | Загальна кількість прийнятих сполук.                                                                                      |
| listen queue         | Кількість запитів (backlog), які очікують вільного процесу.                                                               |
| max listen queue     | Максимальна кількість запитів у черзі на прослуховування будь-якої миті часу.                                             |
| listen queue len     | Максимально допустимий розмір черги прослуховування.                                                                      |
| idle processes       | Кількість процесів, які зараз простоюють (очікують запитів).                                                              |
| active processes     | Кількість процесів, які нині опрацьовують запити.                                                                         |
| total processes      | Поточна загальна кількість процесів.                                                                                      |
| max active processes | Максимальна кількість одночасно активних процесів.                                                                        |
| max children reached | Чи було досягнуто максимальної кількості процесів? Якщо так, то відображуване значення буде `1`, інакше значення буде `0` |
| slow requests        | Загальна кількість запитів, які досягли налаштованого `request_slowlog_timeout`                                           |

**Інформація про кожен процес - відображається лише у режимі виводу `full`**

| Параметр            | Описание                                                                                                                                                                          |
|---------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| pid                 | Системний процес PID.                                                                                                                                                             |
| state               | Стан процесу - Idle, Running, ...                                                                                                                                                 |
| start time          | Дата/час початку процесу.                                                                                                                                                         |
| start since         | Кількість секунд від початку процесу.                                                                                                                                             |
| requests            | Загальна кількість обслуговуваних запитів.                                                                                                                                        |
| request duration    | Загальний час у секундах, витрачений обслуговування запитів.                                                                                                                      |
| request method      | Метод HTTP останнього обслуговуваного запиту.                                                                                                                                     |
| request uri         | URI останнього обслуженого запиту (після обробки веб-сервером він завжди може дорівнювати `/index.php`, якщо ви використовуєте шаблонний редирект фронт-контролера).              |
| content length      | Довжина тіла запиту, в байтах, останній запит.                                                                                                                                    |
| user                | HTTP-користувач (`PHP_AUTH_USER`) останнього запиту.                                                                                                                              |
| script              | Повний шлях до скрипта, виконаного останнім запитом. Це буде `'-'`, якщо не застосовується (наприклад, запити сторінки стану).                                                    |
| last request cpu    | Відсоток використання CPU останнього запиту. Це значення дорівнюватиме 0, якщо процес не знаходиться в стані Idle, тому що обчислення проводиться, коли обробка запиту завершена. |
| last request memory | Максимальний обсяг пам'яті, спожитий останнім запитом. Це значення дорівнюватиме 0, якщо процес не простоює, так як обчислення проводиться після завершення обробки запиту.       |

> **Зауваження**
> 
> Усі значення специфічні для пулу і скидаються під час перезапуску FPM.

> **Зауваження**
> 
> У форматі OpenMetrics використовуються різні типи параметрів, щоб краще відповідати формату OpenMetrics. Параметри та опис їх значень включені у вихідні дані формату OpenMetrics.

### список змін

| Версия | Описание                    |
|--------|-----------------------------|
|        | Доданий формат OpenMetrics. |