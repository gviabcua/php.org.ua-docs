Автоматичне вилучення або створення запису в кеші

-   [« apcu\_enabled](function.apcu-enabled.html)
    
-   [apcu\_exists »](function.apcu-exists.html)
    
-   [PHP Manual](index.html)
    
-   [Функции APCu](ref.apcu.html)
    
-   Автоматичне вилучення або створення запису в кеші
    

# apcuentry

(PECL apcu >= 5.1.0)

apcuentry — Автоматичне вилучення або створення запису в кеші

### Опис

```methodsynopsis
apcu_entry(string $key, callable $generator, int $ttl = 0): mixed
```

Автоматично намагається знайти запис із заданим ключем `key`. Якщо не може, то викликається генератор `generator` і йому передається ключ `key` як єдиний аргумент. Згенероване значення заноситься в кеш із зазначеним `ttl` та повертається.

> **Зауваження**: Коли контроль передається **apcuentry()**, проводиться ексклюзивне блокування кешу, яке знімається після завершення роботи **apcuentry()**: це призводить до того, що тіло генератора `generator` міститься в критичну секцію, забороняючи двом процесам запустити виконання однакового коду конкурентно. До того ж, це призводить до заборони конкурентного запуску будь-яких інших функцій APCu, оскільки вони виставлятимуть те ж саме блокування.

**Увага**

Єдина функція APCu, яку можна безпечно викликати у генераторі `generator` - це **apcuentry()**

### Список параметрів

`key`

Ідентифікатор запису

`generator`

Callback-функція, яка приймає один параметр `key` і повертає значення для кешування.

`ttl`

Час життя; змінна `var` буде зберігатися протягом `ttl` секунд. Як тільки `ttl` секунд пройдуть, змінну буде видалено з кеша (при наступному запиті). Якщо параметр `ttl` не заданий (або `ttl` заданий як `0`), значення буде зберігатися доки не буде видалено явно, або з технічної причини (очищення кешу, перезапуск і т.д.)

### Значення, що повертаються

Повертає закешоване значення

### Приклади

**Приклад #1 Приклад використання **apcuentry()****

```php
<?php
$config = apcu_entry("config", function($key) {
 return [
   "fruit" => apcu_entry("config.fruit", function($key){
     return [
       "apples",
       "pears"
     ];
   }),
   "people" => apcu_entry("config.people", function($key){
     return [
      "bob",
      "joe",
      "niki"
     ];
   })
 ];
});

var_dump($config);
?>
```

Результат виконання цього прикладу:

```
array(2) {
  ["fruit"]=>
  array(2) {
    [0]=>
    string(6) "apples"
    [1]=>
    string(5) "pears"
  }
  ["people"]=>
  array(3) {
    [0]=>
    string(3) "bob"
    [1]=>
    string(3) "joe"
    [2]=>
    string(4) "niki"
  }
}
```

### Дивіться також

-   [apcu\_store()](function.apcu-store.html) - Кешує змінну
-   [apcu\_fetch()](function.apcu-fetch.html) - Витягує з кеша збережену змінну
-   [apcu\_delete()](function.apcu-delete.html) - Видаляє збережене значення з кешу