Налаштування під час виконання

-   [« Установка](apcu.installation.md)
    
-   [Типи ресурсів »](apcu.resources.md)
    
-   [PHP Manual](index.md)
    
-   [Встановлення та налаштування](apcu.setup.md)
    
-   Налаштування під час виконання
    

## Налаштування під час виконання

Поведінка цих функцій залежить від установок у php.ini.

Хоча налаштувань APCu за умовчанням цілком достатньо більшості завдань, але серйозних проектів необхідно уважно вивчити такі настройки.

При налаштуванні APCu необхідно визначити, скільки пам'яті надати APCu. Директива ini-файлу, відповідальна за це налаштування - `apc.shm_size`. Уважно прочитайте наступний розділ.

Як тільки сервер запущено, скрипт `apc.php`, що поставляється з цим модулем, повинен бути скопійований у "docroot" і права на нього повинні дозволяти запустити його через браузер. Цей скрипт надає детальну інформацію щодо роботи APCu. Якщо PHP підтримується GD, цей скрипт також показуватиме корисні графіки. Звичайно ж перше, що буде цікаво, це те, чи кешує APC щось. Якщо APC працює, то значення `Cache full count` (ліворуч) показуватиме, скільки разів кеш був повністю заповнений і був змушений примусово видалити записи, до яких не зверталися останні `apc.ttl` секунд. Чим менше це число - тим краще налаштований кеш. Якщо це число постійно зростає, значить APCu доводиться постійно очищати старі записи і втрачається весь сенс кешування. Найкращий спосіб зменшити це число - це додати пам'ять APCu. Якщо зробити цього не можна, то треба переналаштувати `apc.filters`, щоб обмежити набір скриптів, що кешуються.

Якщо APCu зібраний з підтримкою mmap (Memory Mapping), він використовуватиме лише один сегмент пам'яті, а навпаки, APC зібраний із підтримкою SHM (SysV Shared Memory), він використовуватиме кілька сегментів. MMAP не має максимального обмеження, на відміну від SHM, який обмежується `/proc/sys/kernel/shmmax`. Зазвичай рекомендується використовувати MMAP, тому що він швидше виділяє пам'ять при перезавантаженні веб-сервера, що позначається на швидкості запуску сервера.

**Опції конфігурації APCu**

| Имя | По умолчанию | Место изменения | Список изменений |
| --- | --- | --- | --- |
| [apc.enabled](apcu.configuration.html#ini.apcu.enabled) | "1" | PHPINISYSTEM |  |
| [apc.shmsegments](apcu.configuration.html#ini.apcu.shm-segments) | "1" | PHPINISYSTEM |  |
| [apc.shmsize](apcu.configuration.html#ini.apcu.shm-size) | "32M" | PHPINISYSTEM |  |
| [apc.entrieshint](apcu.configuration.html#ini.apcu.entries-hint) | "4096" | PHPINISYSTEM |  |
| [apc.ttl](apcu.configuration.html#ini.apcu.ttl) | "0" | PHPINISYSTEM |  |
| [apc.gcttl](apcu.configuration.html#ini.apcu.gc-ttl) | "3600" | PHPINISYSTEM |  |
| [apc.mmapfilemask](apcu.configuration.html#ini.apcu.mmap-file-mask) | NULL | PHPINISYSTEM |  |
| [apc.slamdefense](apcu.configuration.html#ini.apcu.slam-defense) | "1" | PHPINISYSTEM |  |
| [apc.enablecli](apcu.configuration.html#ini.apcu.enable-cli) | "0" | PHPINISYSTEM |  |
| [apc.userequesttime](apcu.configuration.html#ini.apcu.use-request-time) | "0" | PHPINIALL | До APCu 5.1.19 значення за промовчанням було "1". |
| [apc.serializer](apcu.configuration.html#ini.apcu.serializer) | "php" | PHPINISYSTEM | До APCu 5.1.19 значення за промовчанням було "default". |
| [apc.coredumpunmap](apcu.configuration.html#ini.apcu.coredump-unmap) | "0" | PHPINISYSTEM |  |
| [apc.preloadpath](apcu.configuration.html#ini.apcu.preload-path) | NULL | PHPINISYSTEM |  |

Для детального опису констант PHPINI, зверніться до розділу [Де можуть бути встановлені параметри конфігурації](configuration.changes.modes.md)

Коротке пояснення конфігураційних директив.

`apc.enabled` bool

Якщо встановити `apc.enabled` рівним 0, то APCu не буде запущено. Це корисно, коли APCu статично включений до PHP і немає інших варіантів для заборони його використання. Якщо APC зібрано як DSO, можна просто закоментувати рядок `extension` в `php.ini`

`apc.shm_segments` int

Кількість сегментів пам'яті, що розділяється, виділеної під кеш. Якщо APC використовував всю доступну пам'ять, що розділяється, а `apc.shm_size` таким великим, як дозволяє система, збільшення цього параметра може допомогти.

`apc.shm_size` string

Розмір сегмента пам'яті, що розділяється, заданий в короткій нотації (дивіться [цей FAQ](faq.using.html#faq.using.shorthandbytes)). За замовчуванням деякі системи (включаючи більшість варіантів BSD) обмежують це значення вкрай малим значенням.

`apc.entries_hint` int

Це підказка про кількість унікальних змін користувачів, які треба кешувати. Встановіть рівним нулю або взагалі не вказуйте, якщо не впевнені.

`apc.ttl` int

Кількість секунд, які запис може лежати в кеші без звернення до неї, перш ніж буде дозволено замінити її на іншу. Встановлення цього параметра рівного нулю може призвести до того, що місце буде забите і нові записи не зможуть потрапити в кеш. Якщо параметр дорівнює 0, кеш буде повністю очищений. Якщо ж ttl буде більше нуля, то APCu намагатиметься очистити застарілі записи.

`apc.gc_ttl` int

Кількість секунд, які запис може перебувати у списку збирача сміття. Це значення забезпечує безвідмовність у разі падіння сервера під час виконання закешованого файлу. Якщо файл, що виконується, був змінений, пам'ять, виділена під кешування його старої версії, не буде повернена до закінчення цього часу. Встановлення в нуль вимикає цей функціонал.

`apc.mmap_file_mask` string

Якщо зібрано за допомогою MMAP, за допомогою опції `--enable-mmap`, цей параметр повинен містити файлову маску типу mktemp-style для передачі в модуль MMAP, щоб визначити, чи MMAP використовуватиме файлову систему або пам'ять, що розділяється. Для файлової системи задайте опцію як `/tmp/apc.XXXXXX` (рівно 6 `X`). Для використання shmopen/mmap у стилі POSIX, додайте `.shm` у будь-якому місці маски, наприклад `/apc.shm.XXXXXX` Ви також можете встановити його як `/dev/zero` для використання інтерфейсу ядра `/dev/zero` для анонімної пам'яті mmap. Якщо не встановлено, то буде примусово використовуватися анонімний mmap.

`apc.slam_defense` int

На дуже завантажених серверах, коли ви запускаєте веб-сервер, відразу багато процесів намагатимуться закешувати один і той же файл одночасно. Цією опцією задається можливість у відсотках того, що спроба одного конкретного процесу закешувати дані буде відхилена. Наприклад, якщо `apc.slam_defense` встановити рівній `75`, то це означає, що ймовірність закешувати файл, якого в кеші немає, дорівнюватиме 25% і ймовірність того, що в кешуванні буде відмовлено дорівнює 75%. Для заборони цього функціоналу встановіть цей параметр рівним `0`

`apc.enable_cli` int

Більше для тестування та налагодження. Ця установка включає APCu для CLI версії PHP. При звичайній роботі, запускати APCu, який створюватиме, наповнюватиме і знищуватиме кеш при кожному запуску сценарію в консолі, буде далеко не найкращою ідеєю. Але з метою тестування та налагодження можна легко включити APCu для CLI.

`apc.serializer` string

Вказує APC на використання стороннього серіалізатора.

`apc.coredump_unmap` bool

Дозволяє APC перехоплювати сигнали, такі як SIGSEGV, який записує coredump, коли подано. Коли ці сигнали будуть отримані, APC спробує звільнити всю пам'ять, що розділяється, щоб не включати її в coredump. Ця установка може збільшити стабільність системи, коли критичний сигнал був отриманий, а APC налаштований на використання великого об'єму пам'яті.

**Увага**

Ця можливість потенційно небезпечна. Звільнення сегментів пам'яті при отриманні критичного сигналу може призвести до непередбачуваної поведінки.

> **Зауваження**
> 
> Хоча деякі ядра надають можливість ігнорувати деякі сегменти пам'яті, що розділяється при записі core-файлу, ці реалізації можуть також ігнорувати важливі сегменти пам'яті, такі як Apache scoreboard.

`apc.preload_path` string

Опціонально. Вказує шлях, який використовується APC для завантаження кешованих даних під час запуску.

`apc.use_request_time` bool

Використовувати час старту запиту SAPI для TTL.