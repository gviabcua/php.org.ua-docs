---
navigation:
  - pdo.constants.html: « Обумовлені константи
  - pdo.transactions.html: Транзакції та автоматична фіксація змін »
  - index.html: PHP Manual
  - book.pdo.html: PDO
title: Підключення та керування підключеннями
---
# Підключення та керування підключеннями

З'єднання встановлюються автоматично під час створення об'єкта PDO з його базового класу. Не має значення, який драйвер ви хочете використати; Ви завжди використовуєте ім'я базового класу. Конструктор класу приймає аргументи для завдання джерела даних (DSN), а також необов'язкові ім'я користувача та пароль (якщо є).

**Приклад #1 Підключення до MySQL**

```php
<?php
$dbh = new PDO('mysql:host=localhost;dbname=test', $user, $pass);
?>
```

У разі виникнення помилки при підключенні буде викинуто виняток `PDOException`. Його можна перехопити та обробити, або залишити на відкуп глобальному обробнику помилок, який ви задали функцією [setexceptionhandler()](function.set-exception-handler.html)

**Приклад #2 Обробка помилок підключення**

```php
<?php
try {
    $dbh = new PDO('mysql:host=localhost;dbname=test', $user, $pass);
    foreach($dbh->query('SELECT * from FOO') as $row) {
        print_r($row);
    }
    $dbh = null;
} catch (PDOException $e) {
    print "Error!: " . $e->getMessage() . "<br/>";
    die();
}
?>
```

**Увага**

Якщо ваша програма не перехоплює виняток PDO конструктора, двигун zend виконає стандартні операції для завершення роботи скрипту та виведення зворотного трасування. У цьому трасуванні міститься детальна інформація про з'єднання з базою даних, включаючи ім'я користувача та пароль. Відповідальність за перехоплення винятків лежить на вас. Перехопити виняток можна явно (за допомогою виразу `catch`), або неявно, задавши глобальний обробник помилок функцією [setexceptionhandler()](function.set-exception-handler.html)

При успішному підключенні до бази даних до скрипта буде повернено створений об'єкт PDO. З'єднання залишається активним протягом усього життя об'єкта. Щоб закрити з'єднання, необхідно знищити об'єкт шляхом видалення всіх посилань на нього (цього можна досягти, привласнюючи **`null`** всім змінним, що вказує на об'єкт). Якщо не зробити цього очевидно, PHP автоматично закриє з'єднання після закінчення роботи скрипта.

> **Зауваження**: Якщо існують інші посилання на цей екземпляр PDO (наприклад, з об'єкта PDOStatement або інші змінні, що посилаються на нього), вони також повинні бути видалені (наприклад, присвоєнням) **`null`** змінної, що посилається на PDOStatement).

**Приклад #3 Закриття з'єднання**

```php
<?php
$dbh = new PDO('mysql:host=localhost;dbname=test', $user, $pass);
// здесь мы каким-то образом используем соединение
$sth = $dbh->query('SELECT * FROM foo');

// соединение больше не нужно, закрываем
$sth = null;
$dbh = null;
?>
```

У багатьох програмах може бути корисним використання постійних з'єднань до баз даних. Постійні з'єднання не закриваються при завершенні роботи скрипта, вони кешуються і використовуються повторно, коли інший скрипт запитує з'єднання з тими самими обліковими даними. Постійні з'єднання дозволяють уникнути створення нових підключень щоразу, коли потрібен обмін даними з базою, що в результаті дає приріст швидкості роботи таких програм.

**Приклад #4 Постійні з'єднання**

```php
<?php
$dbh = new PDO('mysql:host=localhost;dbname=test', $user, $pass, array(
    PDO::ATTR_PERSISTENT => true
));
?>
```

Значення параметру **`PDO::ATTR_PERSISTENT`** перетворюється на логічне значення (bool) (увімкнути/вимкнути постійні підключення), якщо це не числовий рядок (string), який у цьому випадку дозволяє використовувати кілька пулів постійних підключень. Це корисно, якщо різні з'єднання використовують несумісні налаштування, наприклад різні значення **`PDO::MYSQL_ATTR_USE_BUFFERED_QUERY`**

> **Зауваження**
> 
> Щоб використовувати постійні з'єднання, необхідно додати константу **`PDO::ATTR_PERSISTENT`** масив параметрів драйвера, який передається конструктору PDO. Якщо просто встановити цей атрибут функцією [PDO::setAttribute()](pdo.setattribute.html) вже після створення об'єкта, драйвер не використовуватиме постійні з'єднання.

> **Зауваження**
> 
> Якщо ви використовуєте PDO ODBC драйвер і ваші ODBC бібліотеки підтримують об'єднання підключень до пулу (ODBC Connection Pooling) (unixODBC і Windows точно підтримують, але можуть бути й інші), то рекомендується замість постійних з'єднань користуватися цим пулом. Пул підключень ODBC доступний для всіх модулів поточного процесу; якщо PDO сам кешує з'єднання, це з'єднання буде недоступне іншим модулям і потрапить у пул. У результаті кожен модуль створюватиме додаткові підключення для своїх потреб.
