Підмаски

-   [« Установка внутренних опций](regexp.reference.internal-options.html)
    
-   [Повторение »](regexp.reference.repetition.html)
    
-   [PHP Manual](index.html)
    
-   [Описание синтаксиса Perl-совместимых регулярных выражений](reference.pcre.pattern.syntax.html)
    
-   Підмаски
    

## Підмаски

Підмаски обмежуються круглими дужками, які можуть бути вкладеними. Використання частини шаблону як підмаски має такі функції:

1.  Локалізує набір альтернатив. Наприклад, шаблон `cat(aract|erpillar|)` відповідає одному зі слів "cat", "cataract" або "caterpillar". Без використання дужок він відповідав би рядкам "cataract", "erpillar" або порожньому рядку.
    
2.  Вказує на необхідність захоплення підрядка (як показано вище). У тому випадку, якщо відповідність шаблону було знайдено, підрядок, що відповідає підмаску, також передається назад, що викликає за допомогою аргументу *ovector* функції **pcreexec()**. Круглі дужки, що відкривають, нумеруються зліва направо (починаючи з одиниці) і їх порядкові номери використовуються для нумерації відповідних підрядок в результаті.
    

Наприклад, якщо рядок "The Red King" зіставляється з шаблоном `the ((red|white) (king|queen))`, будуть захоплені підрядки "red king", "red" та "king", з номерами 1, 2 та 3 відповідно.

Насправді виконання одночасно двох функцій не завжди зручне. Трапляються випадки, коли необхідне угруповання альтернатив без захоплення рядка. У випадку, якщо після круглої дужки слід "?:", захоплення рядка не відбувається, і поточна підмаска не нумерується. Наприклад, якщо рядок "the white queen" зіставляється із шаблоном `the ((?:red|white) (king|queen))`, будуть захоплені підрядки "white queen" та "queen", і вони будуть пронумеровані 1 та 2 відповідно. Максимальна кількість підмасок - 65535. Такі великі шаблони можуть не скомпілюватися, залежно від налаштувань libpcre.

У випадку, якщо в незахоплюючій підмасці необхідно вказати додаткові опції, можна скористатися зручним скороченням: символ, що позначає опцію, що встановлюється, поміщається між "?" та ":". Таким чином, наступні два шаблони

```
(?i:saturday|sunday)
(?:(?i)saturday|sunday)
```

відповідають тому самому набору рядків. Оскільки альтернативні версії беруться ліворуч, і встановлені опції зберігають свою дію до кінця підмаски, опція, встановлена ​​в одній гілці, також має ефект у всіх наступних гілках. Тому наведені вище шаблони збігаються як із "SUNDAY", і з "Saturday".

Також можна використовувати іменовані підмаски за допомогою синтаксису `(?P<name>pattern)`. Ця підмаска буде індексована в масиві збігів, крім звичайного числового індексу, ще й на ім'я name. Також існують два альтернативні синтаксиси: `(?<name>pattern)` і `(?'name'pattern)`

Іноді буває необхідно мати кілька збігів, що виключають одне одного. Зазвичай кожен такий збіг отримує свій власний номер, навіть якщо шаблон дозволяє збігтися тільки одному з них. Синтаксис `(?|` дозволяє обійти цю поведінку і прибрати номери, що дублюються. Розглянемо наступне регулярне вираз, зіставлене з рядком `Sunday`

```
(?:(Sat)ur|(Sun))day
```

Тут `Sun` зберігається на посиланні 2, тоді як посилання 1 порожня. Якщо ж співпаде `Sat`, то вона буде поміщена на посилання 1, а посилання 2 взагалі не існуватиме. Використання `(?|` у шаблоні вирішує цю проблему:

```
(?|(Sat)ur|(Sun))day
```

У цьому шаблоні обидві підмаски `Sun` і `Sat` буде збережено під номером 1.