---
navigation:
  - migration71.constants.md: « Нові глобальні константи
  - migration71.deprecated.md: 'Функціонал, оголошений застарілим у PHP 7.1.x'
  - index.md: PHP Manual
  - migration71.md: Міграція з PHP 7.0.x на PHP 7.1.x
title: 'Зміни, що ламають зворотну сумісність'
origin_hash: ddf652f5224dc9f1fa9671347921941ca401ea50
---
## Зміни, що ламають зворотну сумісність

### Виклик виключення під час передачі функції недостатньої кількості аргументів

Раніше, якщо функція користувача викликалася з недостатньою кількістю аргументів, видавалося попередження. Тепер замість попередження буде викликатися виняток класу Error. Ця зміна зачіпає лише функції користувача і не впливає на вбудовані. Наприклад:

```php
<?php
function test($param){}
test();
```

Висновок наведеного прикладу буде схожим на:

```
Fatal error: Uncaught ArgumentCountError: Too few arguments to function test(), 0 passed in %s on line %d and exactly 1 expected in %s:%d
```

### Заборона динамічного виклику функцій інтроспекції області видимості

Динамічні виклики певних функцій були заборонені (у вигляді `$func()`или`array_map('extract', ...)`, і т.д.) Ці функції перевіряють або модифікують об'єкти іншої області видимості, чим викликають неоднозначну та невизначену поведінку. Список таких функцій:

-   [assert()](function.assert.md) \- з рядком як перший аргумент
-   [compact()](function.compact.md)
-   [extract()](function.extract.md)
-   [func\_get\_args()](function.func-get-args.md)
-   [func\_get\_arg()](function.func-get-arg.md)
-   [func\_num\_args()](function.func-num-args.md)
-   [get\_defined\_vars()](function.get-defined-vars.md)
-   [mb\_parse\_str()](function.mb-parse-str.md) \- з одним аргументом
-   [parse\_str()](function.parse-str.md) \- з одним аргументом

```php
<?php
(function () {
    $func = 'func_num_args';
    $func();
})();
```

Результат виконання наведеного прикладу:

```
Warning: Cannot call func_num_args() dynamically in %s on line %d
```

### Некоректні імена класів, інтерфейсів та трейтів

Наступні імена не можна використовувати як класи, інтерфейси або трейти:

-   void
-   [iterable](language.types.iterable.md)

### Перетворення числових рядків тепер враховує наукову нотацію

Цілочисельні операції та конвертації числових рядків тепер враховують наукову нотацію, включаючи приведення `(int)`и следующие функции:[intval()](function.intval.md) (З базою 10), [settype()](function.settype.md) [decbin()](function.decbin.md) [decoct()](function.decoct.md) і [dechex()](function.dechex.md)

### Исправление алгоритма[mt\_rand()](function.mt-rand.md)

[mt\_rand()](function.mt-rand.md) тепер за умовчанням використовує зафіксовану версію алгоритму "Вихор Мерсена". Якщо ви покладалися на детермінований висновок [mt\_srand()](function.mt-srand.md), можна використовувати константу **`MT_RAND_PHP`** як другий, необов'язковий, параметр [mt\_srand()](function.mt-srand.md) задля збереження старої (неправильної) реалізації.

### [rand()](function.rand.md)псевдоним для[mt\_rand()](function.mt-rand.md) і [srand()](function.srand.md)псевдоним для[mt\_srand()](function.mt-srand.md)

[rand()](function.rand.md) і [srand()](function.srand.md) тепер є просто синонімами для [mt\_rand()](function.mt-rand.md) і [mt\_srand()](function.mt-srand.md). Це означає, що виведення наступних функцій змінилося: [rand()](function.rand.md) [shuffle()](function.shuffle.md) [str\_shuffle()](function.str-shuffle.md) і [array\_rand()](function.array-rand.md)

### Заборона використовувати символ видалення з таблиці ASCII в ідентифікаторах

Символ видалення ASCII (`0x7F`) більше не можна використовувати в ідентифікаторах, не обгорнутих у лапки.

### Значение`error_log`изменено на`syslog`

Если ini-параметр`error_log`установлен как`syslog`, то рівні помилок PHP проектуються на рівні помилок "syslog". Це дозволяє більш тонко логувати події, а не як раніше, коли вони записувалися з рівнем "notice".

### Деструктори не викликаються на незавершених об'єктах

Тепер деструктори ніколи не викликаються, якщо було викликано виключення у конструкторі об'єкта. Раніше ця поведінка залежала від того, чи було посилання на об'єкт поза конструктором (наприклад, у трасуванні виключення).

### [call\_user\_func()](function.call-user-func.md) обробляє посилання на аргументи

Тепер [call\_user\_func()](function.call-user-func.md) завжди викликає попередження, якщо викликається функція, що очікує посилання як параметри. Раніше це залежало від того, чи виклик був цілком певним.

Крім того, [call\_user\_func()](function.call-user-func.md) і [call\_user\_func\_array()](function.call-user-func-array.md) більше не припиняють виконання функції у разі. Попередження "expected reference" буде викликано, але функція продовжить виконання.

### Оператор порожнього індексу більше не застосовується до рядків

Застосування оператора порожнього індексу до рядка (`$str[] = $x`) викликає фатальну помилку замість тихого перетворення змінної до масиву.

### Присвоєння через механізм доступу до елемента рядка за індексом стосовно порожнього рядка

Модифікація символу в порожньому рядку тепер працює так само, як і для не порожній. Тобто. запис по неіснуючому зміщенню призведе до перетворення не цілого чисельного зсуву до цілого числа, доповнення рядка до потрібної довжини символами пропуску і використання тільки першого символу з рядка, що присвоюється. Раніше в такій ситуації порожній рядок розглядався як порожній масив.

```php
<?php
$a = '';
$a[10] = 'foo';
var_dump($a);
?>
```

Результат виконання наведеного прикладу в PHP 7.0:

```
array(1) {
  [10]=>
  string(3) "foo"
}
```

Результат виконання наведеного прикладу в PHP 7.1:

```
string(11) "          f"
```

### Віддалені ini-директиви

Наступні ini-директиви були видалені:

-   `session.entropy_file`
-   `session.entropy_length`
-   `session.hash_function`
-   `session.hash_bits_per_character`

### Порядок масиву, коли елементи створені автоматично через присвоєння посилання, було змінено

Порядок розташування елементів масиву, створюваних присвоєнням за посиланням не створених на момент присвоєння елементів, було змінено. Наприклад:

```php
<?php
$array = [];
$array["a"] =& $array["b"];
$array["b"] = 1;
var_dump($array);
?>
```

Результат виконання наведеного прикладу в PHP 7.0:

```
array(2) {
  ["a"]=>
  &int(1)
  ["b"]=>
  &int(1)
}
```

Результат виконання наведеного прикладу в PHP 7.1:

```
array(2) {
  ["b"]=>
  &int(1)
  ["a"]=>
  &int(1)
}
```

### Порядок сортування еквівалентних елементів

Внутрішній алгоритм сортування був покращений, що може призвести до відмінності у порядку розташування еквівалентних елементів після сортування порівняно з попередніми версіями PHP.

> **Зауваження** :
> 
> Не покладайтеся на порядок розташування еквівалентних елементів, оскільки він може змінитися будь-якої миті.

### Повідомлення для помилок E\_RECOVERABLE

Повідомлення для помилок E\_RECOVERABLE змінено з "Catchable fatal error" на "Recoverable fatal error".

### Параметр $options функції unserialize()

Тепер елемент `allowed_classes`параметра $options функции[unserialize()](function.unserialize.md) строго типізований, тобто якщо передати значення з типом, відмінним від array та bool, то unserialize() поверне **`false`** та викличе помилку рівня **`E_WARNING`**

### Конструктор DateTime використовує мікросекунди.

Тепер [DateTime](class.datetime.md) і [DateTimeImmutable](class.datetimeimmutable.md) використовують мікросекунди при створенні з поточним часом, або у явному вигляді, або з рядком відносного часу (наприклад, `"first day of next month"`). Це означає, що порівняння двох поспіль створених екземплярів класу швидше повертатиме **`false`** ніж **`true`** :

```php
<?php
new DateTime() == new DateTime();
?>
```

### Виклик винятків [Error](class.error.md) замість фатальних помилок

Для модуля Date при некоректних даних серіалізації класів [DateTime](class.datetime.md) або [DatePeriod](class.dateperiod.md), або помилки ініціалізації часового поясу із серіалізованих даних, викидатиметься виняток [Error](class.error.md)из методов\*\*\_\_wakeup()** або **\_\_set\_state()\*\*замість виклику фатальної помилки.

У модулі DBA функції маніпулювання даними (такі як [dba\_insert()](function.dba-insert.md)) тепер викидатимуть виняток [Error](class.error.md) замість виклику фатальної помилки, що відловлюється, якщо ключ не містить рівно двох елементів.

У модулі DOM некоректна перевірка контексту схеми чи RelaxNG тепер викидатимуть виняток [Error](class.error.md) замість виклику фатальної помилки. Аналогічно, спроби зареєструвати клас вузла, який не розширює правильний базовий клас, спроби прочитати некоректну властивість або перезаписати властивість доступну тільки для читання викидатимуть виняток [Error](class.error.md)

У модулі IMAP адреса email довша 16385 байт тепер викидатиме виняток [Error](class.error.md) замість виклику фатальної помилки.

Модуль Intl у разі виникнення помилки виклику батьківського конструктора у класі, що успадковує [Collator](class.collator.md) до виклику батьківських методів тепер викидатиме виняток [Error](class.error.md) замість виклику фатальної помилки. Крім того, клонування об'єкта [Transliterator](class.transliterator.md) тепер викидатиме виняток [Error](class.error.md) у разі виникнення помилки клонування внутрішнього transliterator замість виклику фатальної помилки.

Модуль LDAP при вказівці невідомого типу модифікації в **ldap\_batch\_modify()** тепер викидатиме виняток [Error](class.error.md) замість виклику фатальної помилки.

В модуле mbstring функции[mb\_ereg()](function.mb-ereg.md) і [mb\_eregi()](function.mb-eregi.md) тепер викидатимуть виняток [ParseError](class.parseerror.md) у разі некоректного регулярного вираження або у разі використання опції 'e'.

У модулі Mcrypt [mcrypt\_encrypt()](function.mcrypt-encrypt.md) і [mcrypt\_decrypt()](function.mcrypt-decrypt.md) тепер викидатиме виняток [Error](class.error.md) замість виклику фатальної помилки, якщо mcrypt не ініціалізовано.

У модулі mysqli спроби прочитати некоректну властивість або перезаписати властивість доступну тільки для читання будуть викидати виняток [Error](class.error.md) замість виклику фатальної помилки.

У модулі Reflection невдале вилучення відображеного об'єкта або властивості об'єкта викидатимуть виняток [Error](class.error.md) замість виклику фатальної помилки.

У модулі сесій користувальницькі обробники сесії, які не повертають рядок для ідентифікатора сесії, викидатимуть виняток [Error](class.error.md) замість виклику фатальної помилки, коли буде викликано функцію для генерації ідентифікатора.

У модулі SimpleXML спроба створення безіменного чи дублюючого атрибуту викидатиме виняток [Error](class.error.md) замість виклику фатальної помилки.

У модулі SPL спроба клонувати об'єкт **SplDirectory** викидатиме виняток [Error](class.error.md) замість виклику фатальної помилки. Аналогічно, виклик [ArrayIterator::append()](arrayiterator.append.md) коли ітерація об'єкта закінчена викидатиме виняток [Error](class.error.md)

Функция[assert()](function.assert.md), коли їй переданий рядковий аргумент першим параметром, тепер викидатиме виняток [ParseError](class.parseerror.md) замість виклику фатальної помилки, що відловлюється, якщо PHP-код некоректний. Аналогічно, виклик [forward\_static\_call()](function.forward-static-call.md) за межами простору класу викидатиме виняток [Error](class.error.md)

В модуле Tidy ручное создание[tidyNode](class.tidynode.md) викидатиме виняток [Error](class.error.md)

У модулі WDDX циклічні посилання серіалізації викидатимуть виняток [Error](class.error.md) замість виклику фатальної помилки.

У модулі XML-RPC циклічні посилання серіалізації будуть викидати виняток [Error](class.error.md) замість виклику фатальної помилки.

В модуле Zip метод[ZipArchive::addGlob()](ziparchive.addglob.md) викидатиме виняток [Error](class.error.md) замість виклику фатальної помилки, якщо відсутня підтримка glob.

### Лексично пов'язані змінні не можуть перевикористовувати імена

Змінні, прив'язані до [замиканню](functions.anonymous.md) через конструкцію `use`, не можуть використовувати ті ж імена, що і будь-які [superglobals](language.variables.predefined.md), $this або параметри. Наприклад, всі наведені функції викликають фатальну помилку:

```php
<?php
$f = function () use ($_SERVER) {};
$f = function () use ($this) {};
$f = function ($param) use ($param) {};
```

### Змінено тип параметра long2ip()

Тепер [long2ip()](function.long2ip.md)ожидает параметр типа int а не string.

### Кодування та декодування JSON

INI-настройка`serialize_precision`определяет точность сериализации при кодировании значений типа float.

Тепер декодування порожнього ключа призводить до появи властивості з пустим ім'ям, раніше ім'я властивості призводилося до значення `_empty_`

```php
<?php
var_dump(json_decode(json_encode(['' => 1])));
```

Висновок наведеного прикладу буде схожим на:

```
object(stdClass)#1 (1) {
  [""]=>
  int(1)
}
```

При передаче флага\*\*`JSON_UNESCAPED_UNICODE`\*\* у функцію [json\_encode()](function.json-encode.md) послідовності U+2028 та U+2029 будуть екрановані.

### Изменение в семантике параметров[mb\_ereg()](function.mb-ereg.md) і [mb\_eregi()](function.mb-eregi.md)

Третий параметр функций[mb\_ereg()](function.mb-ereg.md) і [mb\_eregi()](function.mb-eregi.md) `regs`) тепер встановлюється рівним порожньому масиву, якщо не було знайдено збігів. Раніше параметр залишався незмінним.

### Видалено підтримку потоку sslv2

Підтримка потоку sslv2 у OpenSSL видалена.

### Заборонено "return;" для типізованих повернень вже під час компіляції

Оператори повернення без аргументів у функціях, які оголошують тип значення, що повертається, тепер викликають **`E_COMPILE_ERROR`** (якщо тип повернення не оголошено як void), навіть якщо оператора повернення ніколи не буде досягнуто.
