Робота зі з'єднаннями

-   [« Робота з віддаленими файлами](features.remote-files.html)
    
-   [Постійні з'єднання з базами даних »](features.persistent-connections.html)
    
-   [PHP Manual](index.html)
    
-   [Відмітні особливості](features.html)
    
-   Робота зі з'єднаннями
    

# Робота зі з'єднаннями

Статус з'єднання зберігається внутрішніми механізмами PHP. Нижче перераховані чотири можливі стани:

-   0 - NORMAL
-   1 - ABORTED
-   2 - TIMEOUT
-   3 - ABORTED та TIMEOUT

Під час штатного виконання PHP-скрипту встановлено статус NORMAL. Якщо віддалений клієнт розірвав з'єднання, статус змінюється на ABORTED. Найчастіше від'єднання віддаленого клієнта відбувається при натисканні кнопки "Stop" у браузері. Якщо досягається встановлений часовий ліміт (ознайомтеся з функцією [settimelimit()](function.set-time-limit.html)), буде встановлено статус TIMEOUT.

Ви можете вирішувати, чи призводить відключення клієнта до завершення вашого скрипту. Іноді буває необхідно, щоб скрипт виконався до кінця, навіть якщо відсутня віддалений браузер, якому адресовано весь висновок. За замовчуванням скрипт завершує роботу при відключенні клієнта. Ця поведінка може бути змінена за допомогою опції ignoreuserabort у конфігураційному файлі php.ini. Такого ж результату можна досягти, вказавши `php_value ignore_user_abort` у конфігураційному файлі Apache httpd.conf або скориставшись функцією [ignoreuserabort()](function.ignore-user-abort.html). Якщо ви не вказали на необхідність ігнорувати розрив з'єднання з клієнтом, виконання скрипту буде перервано. Винятком є ​​той випадок, якщо використовуючи [registershutdownfunction()](function.register-shutdown-function.html), ви вказали спеціальну функцію, що викликається після завершення скрипта. У такому випадку після того, як користувач натиснув кнопку "Stop" у своєму браузері, при першій спробі що-небудь вивести PHP виявляє, що з'єднання з клієнтом було втрачено, і викликає завершальну функцію. Ця функція також викликається при нормальному завершенні роботи вашого скрипта, тому для того, щоб виконати деякі специфічні дії при від'єднанні клієнта, вам знадобиться функція [connectionaborted()](function.connection-aborted.html), яка повертає \*\*`true`\*\*якщо з'єднання було розірвано.

Виконання вашого скрипта також може бути перервано вбудованим таймером. Стандартне обмеження часу становить 30 секунд, змінити його можна за допомогою директиви **maxexecutiontime** у конфігураційному файлі php.ini. Такого ж результату можна досягти, додавши `php_value max_execution_time` у конфігураційний файл Apache httpd.conf або скориставшись функцією [settimelimit()](function.set-time-limit.html). При досягненні скриптом тимчасового ліміту виконання скрипту переривається і викликається завершальна функція, якщо вона була вказана. Уточнити причину завершення скрипту можна за допомогою функції [connectionstatus()](function.connection-status.html), яка повертає 2, якщо скрипт був перерваний для досягнення тимчасового обмеження.

Єдине, що слід помітити - що обидва статуси: ABORTED і TIMEOUT - можуть бути встановлені одночасно. Це може статися в тому випадку, якщо ви явно вказали на необхідність ігнорувати від'єднання віддаленого клієнта. У такому випадку після розриву з'єднання, відзначивши цей факт, PHP продовжить виконання скрипту, і при досягненні тимчасового ліміту буде викликана завершальна функція, якщо така була вказана. У цій точці ви можете виявити, що [connectionstatus()](function.connection-status.html) поверне значення 3.