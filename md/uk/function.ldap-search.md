---
navigation:
  - function.ldap-sasl-bind.md: « ldapsaslbind
  - function.ldap-set-option.md: ldapsetoption »
  - index.md: PHP Manual
  - ref.ldap.md: Функції LDAP
title: ldapsearch
---
# ldapsearch

(PHP 4, PHP 5, PHP 7, PHP 8)

ldapsearch — Пошук по LDAP дереву

### Опис

```methodsynopsis
ldap_search(    LDAP\Connection|array $ldap,    array|string $base,    array|string $filter,    array $attributes = [],    int $attributes_only = 0,    int $sizelimit = -1,    int $timelimit = -1,    int $deref = LDAP_DEREF_NEVER,    ?array $controls = null): LDAP\Result|array|false
```

Виконує пошук для зазначеного фільтра у директорії з межами **`LDAP_SCOPE_SUBTREE`**. Еквівалентний пошук по всьому каталогу.

Можна також виконувати паралельний пошук. У цьому випадку першим аргументом має бути масив екземплярів [LDAPConnection](class.ldap-connection.md), а чи не один екземпляр. Якщо пошук не повинен використовувати один і той же базовий DN і фільтр, як аргументи можна передати масив базових DN і/або масив фільтрів. Кількість елементів у масивах має збігатися з кількістю екземплярів [LDAPConnection](class.ldap-connection.md)оскільки перші записи масивів використовуються для одного пошуку, другі - для іншого і так далі. При паралельному пошуку повертається масив екземплярів [LDAPResult](class.ldap-result.md), за винятком виникнення помилки, коли повертається значення **`false`**

### Список параметрів

`ldap`

Екземпляр [LDAPConnection](class.ldap-connection.md), що повертається функцією [ldapconnect()](function.ldap-connect.md)

`base`

Базове DN для каталогу.

`filter`

Пошуковий фільтр може бути простим або розширеним, використовуючи булеві оператори у форматі, описаному в документації LDAP (див. [» Netscape Directory SDK](https://wiki.mozilla.org/Mozilla_LDAP_SDK_Programmer%27s_Guide/Searching_the_Directory_With_LDAP_C_SDK) або [» RFC4515](http://www.faqs.org/rfcs/rfc4515) для повної інформації про фільтри).

`attributes`

Масив необхідних атрибутів, наприклад, `array("mail", "sn", "cn")`. Зауважте, що "dn" завжди повертається, незалежно від того, які типи атрибутів потрібні.

Використання цього параметра набагато ефективніше, ніж стандартна дія (яка повинна повернути всі атрибути та присвоєні їм значення). Тому використання цього параметра вважається гарною практикою.

`attributes_only`

Повинен дорівнювати 1, якщо потрібні тільки типи атрибута. Якщо дорівнює 0, то, за умовчанням, вибираються типи атрибутів і значення.

`sizelimit`

Дозволяє обмежити кількість вибраних записів. Встановлення цього параметра дорівнює 0 означає, що обмеження відсутнє.

> **Зауваження**
> 
> Цей параметр НЕ може перевизначати попереднє встановлення sizelimit на стороні сервера. Хоча його можна встановити нижче.
> 
> Деякі хости серверів каталогів будуть налаштовані так, щоб повернути не більше, ніж попередньо встановлена ​​кількість записів. Якщо це станеться, сервер вкаже, що повернув лише частковий набір результатів. Це також відбувається, якщо Ви використовуєте цей параметр, щоб обмежити кількість вибраних записів.

`timelimit`

Встановлює кількість секунд, що обмежує процес пошуку. Встановлення цього параметра дорівнює 0 означає, що обмеження відсутнє.

> **Зауваження**
> 
> Цей параметр НЕ може перевизначати передустановку timelimit на стороні сервера. Хоча його можна встановити нижче.

`deref`

Визначає, як псевдоніми повинні бути оброблені під час пошуку. Може бути одним із наступних:

-   **`LDAP_DEREF_NEVER`** - (за умовчанням) псевдоніми ніколи не розіменовуються.
-   **`LDAP_DEREF_SEARCHING`** - псевдоніми мають бути розіменовані під час пошуку, але не при визначенні розташування базового об'єкта пошуку.
-   **`LDAP_DEREF_FINDING`** - псевдоніми мають бути розіменовані щодо місця розташування базового об'єкта, але з під час пошуку.
-   **`LDAP_DEREF_ALWAYS`** - псевдоніми мають розіменовуватися завжди.

`controls`

Масив [управляющих констант LDAP](ldap.controls.md) для відправки у запиті.

### Значення, що повертаються

Повертає екземпляр [LDAPResult](class.ldap-result.md), масив екземплярів [LDAPResult](class.ldap-result.md) або **`false`** у разі виникнення помилки.

### список змін

| Версия | Описание |
| --- | --- |
|  | Параметр `ldap` тепер чекає екземпляр [LDAPConnection](class.ldap-connection.md); раніше очікувався ресурс ([resource](language.types.resource.md) |
|  | Повертає екземпляр [LDAPResult](class.ldap-result.md); раніше повертався ресурс ([resource](language.types.resource.md) |
|  | `controls` тепер припускає значення null; раніше значення за умовчанням було `[]` |
|  | Додано підтримку параметра `controls` |

### Приклади

Приклад нижче отримує організаційну одиницю, прізвище, ім'я та адресу електронної пошти для всіх людей у ​​My Company, де прізвище або ім'я містять підрядок $person. Цей приклад використовує логічний фільтр, щоб сказати серверу, що потрібно шукати більше інформації, ніж в одному атрибуті.

**Приклад #1 LDAP пошук**

```php
<?php
// $ds допустимый экземпляр LDAP\Connection

// $person всё или часть имени человека, н-р "Jo"

$dn = "o=My Company, c=US";
$filter="(|(sn=$person*)(givenname=$person*))";
$justthese = array("ou", "sn", "givenname", "mail");

$sr=ldap_search($ds, $dn, $filter, $justthese);

$info = ldap_get_entries($ds, $sr);

echo $info["count"]." записей возвращено\n";
?>
```
