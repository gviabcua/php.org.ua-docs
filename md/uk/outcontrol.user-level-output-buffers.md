---
navigation:
  - outcontrol.flushing-system-buffers.md: « Скидання (відправлення) системних буферів
  - outcontrol.what-output-is-buffered.md: Який висновок буферизується? »
  - index.md: PHP Manual
  - book.outcontrol.md: Контроль виведення
title: Буфери виводу користувача
origin_hash: ddf652f5224dc9f1fa9671347921941ca401ea50
---
## Буфери виводу користувача

Користувальницькі буфери виводу дозволено запускати, маніпулювати ними та завершувати з PHP-коду. Кожен із цих буферів складається з буфера виведення та пов'язаної з ним функції обробника виведення.

## Увімкнення буферизації виводу

Буферизацію виводу включають виклик функції [ob\_start()](function.ob-start.md)или установкой в файле php.ini параметров директивам[output\_buffering](outcontrol.configuration.md#ini.output-buffering) і [output\_handler](outcontrol.configuration.md#ini.output-handler). Хоча обидва способи вміють створювати буфери виводу, функція [ob\_start()](function.ob-start.md) гнучкіше, оскільки приймає як обробників виведення користувацькі функції і вміє задавати операції, дозволені для буфера (скидання, очищення, видалення). Буфери, запущені функцією [ob\_start()](function.ob-start.md), будуть активні з того рядка, з якого була викликана функція, тоді як ті, що були запущені директивою [output\_buffering](outcontrol.configuration.md#ini.output-buffering), буферизуватиме висновок починаючи з першого рядка скрипта.

PHP також поставляється з вбудованим обробником виводу `«URL-Rewriter»`, який запускає свій буфер виводу і дозволяє запускати одночасно до двох його екземплярів (одна для перезапису URL-адрес на рівні користувача та ще одна для підтримки прозорого ідентифікатора сесії). Ці буфери запускають виклик функції [output\_add\_rewrite\_var()](function.output-add-rewrite-var.md) та (або) включенням директиви [session.use\_trans\_sid](session.configuration.md#ini.session.use-trans-sid)в файле php.ini.

У модуль, що входить в комплект `zlib` інтегрований свій буфер виводу, який включають директиву [zlib.output\_compression](zlib.configuration.md#ini.zlib.output-compression)в файле php.ini.

> **Зауваження**: Хотя обработчик`«URL-Rewriter»` і виділяється тим, що дозволяє запускати одночасно лише до двох своїх екземплярів, користувальницькі буфери виведення працюють з тими ж базовими буферами, які використовує функція [ob\_start()](function.ob-start.md), А їх функціональність реалізована користувальницькою функцією обробника виведення. Тому їх функціональність в змозі зімітувати код користувача.

## Скидання, доступ та очищення вмісту буфера

Скидання надсилає та видаляє вміст активного буфера. Буфери виводу скидаються, коли розмір виводу перевищує розмір буфера, скрипт завершує роботу або викликаються функції [ob\_flush()](function.ob-flush.md) [ob\_end\_flush()](function.ob-end-flush.md) або [ob\_get\_flush()](function.ob-get-flush.md)

**Застереження**

Виклик функцій [ob\_end\_flush()](function.ob-end-flush.md) або [ob\_get\_flush()](function.ob-get-flush.md) відключить активний буфер.

**Застереження**

Скидання буферів також скине повертається обробником виводу значення, яке обробник виводу вміє змінювати, і якщо так, значення відрізнятиметься від вмісту буфера. Наприклад, передача в обробник виведення функції [ob\_gzhandler()](function.ob-gzhandler.md) призведе до стиснення даних виведення та скидання стисненого виводу.

Вміст активного буфера одержують викликом функцій [ob\_get\_contents()](function.ob-get-contents.md) [ob\_get\_clean()](function.ob-get-clean.md) або [ob\_get\_flush()](function.ob-get-flush.md)

Якщо потрібно лише розмір вмісту буфера, функції [ob\_get\_length()](function.ob-get-length.md) або [ob\_get\_status()](function.ob-get-status.md) повернуть розмір вмісту у байтах.

**Застереження**

Виклик функцій [ob\_get\_clean()](function.ob-get-clean.md) або [ob\_get\_flush()](function.ob-get-flush.md) відключить активний буфер після повернення вмісту.

Вміст активного буфера очищають викликом функцій [ob\_clean()](function.ob-clean.md) [ob\_end\_clean()](function.ob-end-clean.md) або [ob\_get\_clean()](function.ob-get-clean.md)

**Застереження**

Виклик функцій [ob\_end\_clean()](function.ob-end-clean.md) або [ob\_get\_clean()](function.ob-get-clean.md) вимкне активний буфер виведення.

## Відключення буферів

Буфери виводу вимикають викликом функцій [ob\_end\_clean()](function.ob-end-clean.md) [ob\_end\_flush()](function.ob-end-flush.md) [ob\_get\_flush()](function.ob-get-flush.md) або [ob\_get\_clean()](function.ob-get-clean.md)

**Увага**

Буфери виведення, запущені без прапора **`PHP_OUTPUT_HANDLER_REMOVABLE`**, не можна вимкнути, а спроба видалити такі буфери видасть помилку рівня **`E_NOTICE`**

Кожен буфер виводу, який не був закритий до кінця скрипта або виклику конструкції [exit()](function.exit.md), буде скинуто та вимкнено процесом завершення роботи PHP. Буфери будуть скинуті та відключені у порядку, зворотному їх запуску. Останній запущений буфер буде першим, а перший запущений буфер буде скинутий та відключений в останню чергу.

**Застереження**

Якщо скидання вмісту буферів не потрібне, активують обробний користувач виводу, щоб запобігти скидання при завершенні роботи.

## Винятки в обробниках висновку

Якщо в обробнику виводу викидається неперехоплений виняток, програма завершується, а процес завершення роботи викликає обробник, потім виводиться повідомлення про помилку `Uncaught Exception`

Якщо в обробнику виводу, що викликається функціями [ob\_flush()](function.ob-flush.md) [ob\_end\_flush()](function.ob-end-flush.md) або [ob\_get\_flush()](function.ob-get-flush.md), викидається неперехоплений виняток, вміст буфера скидається перед повідомленням про помилку.

Якщо в обробнику виводу неперехоплений виняток викидається під час вимкнення, обробник завершується, не скидаються ні вміст буфера, ні повідомлення про помилку.

> **Зауваження**: Якщо обробник виводу викидає виняток, PHP встановлює для нього прапор стану **`PHP_OUTPUT_HANDLER_DISABLED`**

## Помилки в обробниках виводу

Якщо в обробнику виводу видана помилка, програма продовжує виконуватися.

Якщо в обробнику, що викликається функціями [ob\_flush()](function.ob-flush.md) [ob\_end\_flush()](function.ob-end-flush.md) або [ob\_get\_flush()](function.ob-get-flush.md), Виникає непереборна помилка, буфер скидає дані, які повернув обробник. Якщо обробник повертає значення \*\*`false`\*\*скидається буфер і повідомлення про помилку. Якщо повертає інше значення, значення, що повертається обробником, скидається, але не повідомлення про помилку.

> **Зауваження**: Якщо обробник повертає значення **`false`** PHP встановлює для нього прапор стану **`PHP_OUTPUT_HANDLER_DISABLED`**

Якщо в обробнику виводу виникає фатальна помилка, програма завершується, а процес завершення роботи викликає обробник, а потім скидається повідомлення про помилку.

Якщо в обробнику виводу, що викликається функціями [ob\_flush()](function.ob-flush.md) [ob\_end\_flush()](function.ob-end-flush.md) або [ob\_get\_flush()](function.ob-get-flush.md), виникає фатальна помилка, виникає, вміст буферів скидається перед повідомленням про помилку.

Якщо фатальна помилка виникає при вимкненні в обробнику виводу, програма завершується без скидання буфера або повідомлення про помилку.

## Виведення обробників висновку

За конкретних обставин вихідні дані, створені в обробнику, скидаються разом із вмістом буфера. Цей висновок не додається до буфера і не стає рядком, що повертається функцією [ob\_get\_flush()](function.ob-get-flush.md)

Якщо під час операцій скидання (при виклику функцій [ob\_flush()](function.ob-flush.md) [ob\_end\_flush()](function.ob-end-flush.md) [ob\_get\_flush()](function.ob-get-flush.md) і при завершенні роботи) значення обробника, що повертається, дорівнює **`false`**, вміст буфера скидається, а потім йде висновок. Якщо обробник не викликається при завершенні роботи, обробник викидає виняток; виклик конструкції [exit()](function.exit.md) поводиться так само.

> **Зауваження**: Якщо обробник повертає значення **`false`**, PHP встановлює для нього прапор стану **`PHP_OUTPUT_HANDLER_DISABLED`**

## Прапори стану обробника виводу

PHP устанавливает[прапори стану оброблювача](outcontrol.constants.md#outcontrol.constants.flags-returned-by-handler) бітової маски прапорів (`flags`) буфера щоразу під час виклику оброблювача виведення і робить їх частиною прапорів (`flags`), що повертаються функцією [ob\_get\_status()](function.ob-get-status.md). Якщо обробник успішно виконується та не повертає значення **`false`**, PHP встановлює прапори стану **`PHP_OUTPUT_HANDLER_STARTED`** і **`PHP_OUTPUT_HANDLER_PROCESSED`**. Якщо обробник повертає значення **`false`** або викидає виняток під час роботи, PHP встановлює прапори стану **`PHP_OUTPUT_HANDLER_STARTED`** і **`PHP_OUTPUT_HANDLER_DISABLED`**

> **Зауваження**: Если для обработчика установлено значение\*\*`PHP_OUTPUT_HANDLER_DISABLED`\*\*, обробник не запускатиметься під час виклику функцій [ob\_end\_clean()](function.ob-end-clean.md) [ob\_end\_flush()](function.ob-end-flush.md) [ob\_get\_clean()](function.ob-get-clean.md) [ob\_get\_flush()](function.ob-get-flush.md) або при завершенні процесу роботи PHP. Цей прапор не дає ефекту під час виклику функцій [ob\_clean()](function.ob-clean.md) або [ob\_flush()](function.ob-flush.md)
