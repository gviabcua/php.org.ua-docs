Виконання PHP-файлів

-   [« Опции](features.commandline.options.html)
    
-   [Потоки ввода/вывода »](features.commandline.io-streams.html)
    
-   [PHP Manual](index.html)
    
-   [Использование PHP в командной строке](features.commandline.html)
    
-   Виконання PHP-файлів
    

## Виконання PHP-файлів

У CLI SAPI є три різні способи запуску PHP-коду:

1.  Вказує конкретний файл для запуску.
    
    ```
    $ php my_script.php
    
    $ php -f my_script.php
    ```
    
    Обидва способи (із зазначенням опції **ф** або без) запустять файл myscript.php. Немає обмежень, який файл запускати; зокрема, файли не повинні мати розширення `.php`
    
2.  Надіслати PHP-код безпосередньо в командному рядку.
    
    ```
    $ php -r 'print_r(get_defined_constants());'
    ```
    
    Необхідно бути особливо обережним під час використання цього, т.к. може статися підстановка змінних оболонок під час використання подвійних лапок.
    
    > **Зауваження**
    > 
    > Уважно прочитайте приклад: у ньому немає тегів, що відкривають і закривають! Опція **р** просто їх не потребує, і їх використання призведе до помилки розбору.
    
3.  Передати PHP-код через стандартний потік введення (`stdin`
    
    Це дає потужну можливість створювати PHP-код і передавати його файлу, як показано в цьому (вигаданому) прикладі:
    
    ```
    $ some_application | some_filter | php | sort -u > final_output.txt
    ```
    

Ви не можете комбінувати будь-який із цих трьох способів запуску коду.

Як і будь-яка інша консольна програма, бінарний файл PHP приймає аргументи, але PHP-скрипт також може отримувати аргументи. PHP не обмежує кількість аргументів, що передаються в скрипт (оболонка консолі встановлює певний поріг кількості символів, які можуть бути передані; зазвичай цього ліміту вистачає). Передані аргументи доступні у глобальному масиві [$argv](reserved.variables.argv.html). Перший індекс (нуль) завжди містить ім'я скрипта з командного рядка. Врахуйте, що якщо код викликається на льоту з командного рядка за допомогою опції **р**, значенням [$argv\[0\]](reserved.variables.argv.html) буде `"Стандартный поток"` ("Standard input code"); до PHP 7.2.0 це був дефіс (`"-"`). Те саме вірно і для коду, переданого через конвеєр з `STDIN`

Друга зареєстрована глобальна змінна – це [$argc](reserved.variables.argc.html), що містить кількість елементів у масиві [$argv](reserved.variables.argv.html) (а *не* кількість аргументів, переданих скрипту).

Якщо аргументи, що передаються, не починаються з символу `-`, то особливих проблем не повинно бути. Передається в скрипт аргумент, який починається з `-` створить проблеми, т.к. PHP вирішить, що він сам має його обробити. Для запобігання такій поведінці використовуйте роздільник списку аргументів `--`. Після того, як цей роздільник буде проаналізовано PHP, всі наступні аргументи будуть передані в скрипт незайманими.

```
# Эта команда не запустит данный код, но покажет информацию об использовании PHP
$ php -r 'var_dump($argv);' -h
Usage: php [options] [-f] <file> [args...]
[...]

# Эта команда передаст аргумент '-h' в скрипт, предотвратив показ справки PHP
$ php -r 'var_dump($argv);' -- -h
array(2) {
  [0]=>
  string(1) "-"
  [1]=>
  string(2) "-h"
}
```

Однак у Unix-системах є ще один спосіб використання PHP для консольних скриптів. Можна написати скрипт, перший рядок якого буде починатися з `#!/usr/bin/php` (або інший коректний шлях до бінарного файлу PHP CLI). Після цього рядка можна помістити звичайний PHP-код, укладений у теги PHP, що відкривають і закривають. Як тільки буде встановлено коректні атрибути запуску на файл (наприклад, **chmod +x test**), скрипт може бути запущений як звичайний консольний або perl-скрипт:

**Приклад #1 Запуск PHP-скрипту як консольного**

```php
#!/usr/bin/php
<?php
var_dump($argv);
?>
```

Припускаючи, що цей файл названий test і знаходиться в поточній директорії, можна зробити таке:

```
$ chmod +x test
$ ./test -h -- foo
array(4) {
  [0]=>
  string(6) "./test"
  [1]=>
  string(2) "-h"
  [2]=>
  string(2) "--"
  [3]=>
  string(3) "foo"
}
```

Як можна побачити, у цьому випадку не потрібно дбати про передачу параметрів, які починаються з `-`

PHP-файл, що виконується, може використовуватися для запуску PHP-скриптів незалежно від веб-сервера. У разі роботи в Unix-подібній системі необхідно додати в перший рядок файлу `#!` (називається також "shebang") щоб вказати, яка програма повинна запускати скрипт. На Windows-платформах можна призначити php.exe для файлів з розширеннями `.php` або створити пакетний (.bat) файл для запуску скриптів за допомогою PHP. Рядок, що додається на початку скрипту для Unix-систем, не впливає на їх роботу в Windows, таким чином можна створювати кросплатформові скрипти. Нижче наведено простий приклад скрипта, який виконується з командного рядка:

**Приклад #2 Скрипт призначений для запуску з командного рядка (script.php)**

```php
#!/usr/bin/php
<?php

if ($argc != 2 || in_array($argv[1], array('--help', '-help', '-h', '-?'))) {
?>

Это консольный PHP-скрипт, принимающий один аргумент.

  Использование:
  <?php echo $argv[0]; ?> <option>

  <option> Любое слово, которое вы хотели бы
  напечатать. Опции  --help, -help, -h,
  или -? покажут текущую справочную информацию.

<?php
} else {
    echo $argv[1];
}
?>
```

У наведеному вище скрипті в першому рядку міститься shebang, що вказує на те, що цей файл повинен запускатися PHP. Робота ведеться з CLIверсією, тому не буде виведено жодного HTTPзаголовка.

Скрипт спочатку перевіряє наявність обов'язкового одного аргументу (на додаток до імені скрипта, який також підраховується). Якщо їх немає, або якщо переданий аргумент був **\-help** **help** **х** або , виводиться довідкове повідомлення з використанням [$argv\[0\]](reserved.variables.argv.html), що містить ім'я скрипта, що виконується. Інакше просто виводиться отриманий аргумент.

Для запуску наведеного прикладу в Unix-системі потрібно зробити його виконуваним і просто виконати в консолі **script.php echothis** або **script.php -h**. У Windows-системі можна створити пакетний файл:

**Приклад #3 Пакетний файл для запуску PHP-скрипту з командного рядка (script.bat)**

@echo OFF "C:phpphp.exe" script.php %

Припускаючи, що наведений вище скрипт називається script.php, а повний шлях до CLI php.exe знаходиться в C:phpphp.exe, цей пакетний файл запустить його з переданими параметрами: **script.bat echothis** або **script.bat -h**

Також можна ознайомитись із модулем [Readline](ref.readline.html) для отримання додаткових функцій, які можна використовувати для покращення консольного PHP-скрипту.

У Windows запуск PHP можна налаштувати без необхідності вказувати C:phpphp.exe або розширення `.php`. Докладніше цю тему описано в розділі [Запуск PHP из командной строки в Microsoft Windows](install.windows.commandline.html)

> **Зауваження**
> 
> У Windows рекомендується запускати PHP під актуальним обліковим записом користувача. Під час роботи в мережній службі деякі операції не будуть виконані, оскільки "порівняння імен облікових записів та ідентифікаторів безпеки не виконано".