---
navigation:
  - function.pg-port.md: « pg\_port
  - function.pg-put-line.md: pg\_put\_line »
  - index.md: PHP Manual
  - ref.pgsql.md: Функції PostgreSQL
title: pg\_prepare
origin_hash: ddf652f5224dc9f1fa9671347921941ca401ea50
---
# pg\_prepare

(PHP 5 >= 5.1.0, PHP 7, PHP 8)

pg\_prepare — Надсилає запит на створення параметризованого SQL виразу і чекає на його завершення

### Опис

```methodsynopsis
pg_prepare(PgSql\Connection $connection = ?, string $stmtname, string $query): PgSql\Result|false
```

**pg\_prepare()** створює заготівлю SQL вирази на сервері для подальшого запуску функціями [pg\_execute()](function.pg-execute.md) або [pg\_send\_execute()](function.pg-send-execute.md). Це дозволяє багаторазово виконувати один раз створені запити з різними параметрами . **pg\_prepare()** підтримується PostgreSQL версії 7.4 та вище. Функція не працюватиме з серверами ранніх версій.

Функція створює заготівлю SQL запиту під назвою `stmtname` і тілом `query`, який повинен містити один SQL вираз . `stmtname` може бути порожнім рядком, тоді буде створено безіменну заготівлю. Якщо якась безіменна заготовка вже визначена, вона буде замінена на нову автоматично. В інших випадках збіг імен нової та існуючої в даній сесії заготовок призведе до помилки. Якщо в `query` будуть передаватися параметри, вони замінять псевдозмінні $1, $2 і т.д. під час передачі запиту.

Подібні заготівлі запитів можна також робити за допомогою SQL-команди `PREPARE` (але **pg\_prepare()** більш гнучка, оскільки вимагає суворої типізації своїх параметрів). Важливо, що у PHP немає функцій видалення підготовлених SQL-выражений, цього використовуйте команду SQL `DEALLOCATE`

### Список параметрів

`connection`

Екземпляр [PgSql\\Connection](class.pgsql-connection.md). Якщо параметр `connection` не вказано, буде вибрано стандартне з'єднання. Стандартне з'єднання — це останнє з'єднання, яке встановила функція [pg\_connect()](function.pg-connect.md) або [pg\_pconnect()](function.pg-pconnect.md)

**Увага**

Починаючи з версії PHP 8.1.0, використання стандартного з'єднання застаріло.

`stmtname`

Ім'я заготовки, що створюється. Має бути унікальним у межах сесії. Якщо встановлено порожній рядок, буде створено безіменний SQL вираз. При цьому він перезапише вже існуючий безіменний вираз, визначений раніше.

`query`

Параметризований SQL-запит. Повинен містити лише один вираз (кілька виразів розділених крапкою з комою не підтримуються). Якщо в запит будуть передаватися параметри, вони замінять псевдозмінні $1, $2 і т.д.

### Значення, що повертаються

Екземпляр [PgSql\\Result](class.pgsql-result.md) у разі успішного виконання або \*\*`false`\*\*в случае возникновения ошибки.

### список змін

| Версия | Опис |
| --- | --- |
| 8.1.0 | Повертає екземпляр [PgSql\\Result](class.pgsql-result.md); раніше повертався ресурс ([resource](language.types.resource.md) |
| 8.1.0 | Параметр`connection` тепер чекає екземпляр [PgSql\\Connection](class.pgsql-connection.md); раніше очікувався ресурс ([resource](language.types.resource.md) |

### Приклади

**Пример #1 Пример использования**pg\_prepare()\*\*\*\*

```php
<?php
// Подключение к базе данных "mary"
$dbconn = pg_connect("dbname=mary");

// Подготовка запроса
$result = pg_prepare($dbconn, "my_query", 'SELECT * FROM shops WHERE name = $1');

// Запуск запроса на выполнение. Стоит отметить, что нет необходимости экранировать
// спецсимволы в строке "Joe's Widgets"
$result = pg_execute($dbconn, "my_query", array("Joe's Widgets"));

// Запуск на выполнение того же запроса, но с другим параметром
$result = pg_execute($dbconn, "my_query", array("Clothes Clothes Clothes"));

?>
```

### Дивіться також

-   [pg\_execute()](function.pg-execute.md) \- Запускає виконання раніше підготовленого параметризованого запиту та чекає результату
-   [pg\_send\_execute()](function.pg-send-execute.md) \- Запускає попередньо підготовлений SQL-запит та передає йому параметри; не чекає результату, що повертається
