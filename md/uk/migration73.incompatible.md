Зміни, що ламають зворотну сумісність

-   [« Новые глобальные константы](migration73.constants.html)
    
-   [Функционал, объявленный устаревшим в PHP 7.3.x »](migration73.deprecated.html)
    
-   [PHP Manual](index.html)
    
-   [Миграция с PHP 7.2.x на PHP 7.3.x](migration73.html)
    
-   Зміни, що ламають зворотну сумісність
    

## Зміни, що ламають зворотну сумісність

### Ядро PHP

#### Інтерпретація ідентифікатора, що закриває Heredoc/Nowdoc

Завдяки введенню [гибкого синтаксиса heredoc/nowdoc](migration73.new-features.html#migration73.new-features.core.heredoc), doc-рядки, що містять ідентифікатори, що закривають всередині свого тіла, можуть викликати синтаксичні помилки або зміни в інтерпретації. Приклад:

```php
<?php
$str = <<<FOO
abcdefg
   FOO
FOO;
?>
```

З відступом `FOO` раніше не мав особливого значення. Тепер він буде інтерпретуватися як кінець heredoc-рядка і наступний `FOO;` призведе до синтаксичної помилки. Ця проблема завжди може бути вирішена шляхом вибору ідентифікатора, що закриває, який не використовується у вмісті рядка.

#### Генерування попередження в continue, що використовується в switch

Вирази `continue`, що використовуються в структурах управління потоку `switch` тепер видаватиме попередження. У PHP такі висловлювання `continue` еквіваленти `break`, в той час, як в інших мовах вони поводяться як `continue 2`

```php
<?php
while ($foo) {
    switch ($bar) {
      case "baz":
         continue;
         // Предупреждение: "continue" эквивалентен
         //          "break". Возможно, вы имели в виду "continue 2"?
   }
}
?>
```

#### Сувора інтерпретація цілих рядкових ключів на ArrayAccess

Доступ до масиву типу `$obj["123"]`, де `$obj` реалізує [ArrayAccess](class.arrayaccess.html), а `"123"` - це цілий рядковий літерал, більше не призведе до неявного перетворення в ціле число, тобто . `$obj->offsetGet("123")` замість `$obj->offsetGet(123)`. Це відповідає існуючій поведінці для нелітеральних значень. Поведінка масивів не змінилося, вони продовжують неявно перетворювати цілі рядкові ключі на цілі числа.

#### Статичні властивості більше не поділяються присвоєнням за посиланням

У PHP статичні властивості спільно використовуються спадковими класами, якщо статичну властивість явно не перевизначено у дочірньому класі. Однак через помилку реалізації можна було відокремити статичні властивості, надавши їх за посиланням. Ця лазівка ​​була виправлена.

```php
<?php
class Test {
    public static $x = 0;
}
class Test2 extends Test { }

Test2::$x = &$x;
$x = 1;

var_dump(Test::$x, Test2::$x);
// Ранее:  int(0), int(1)
// Теперь: int(1), int(1)
?>
```

#### Посилання, що повертаються при доступі до масиву або властивості, негайно розпаковуються.

Посилання, що повертаються доступом до масиву та властивості, тепер розпаковуються як частина доступу. Це означає, що більше неможливо змінити посилання між доступом та використанням доступного значення:

```php
<?php
$arr = [1];
$ref =& $arr[0];
var_dump($arr[0] + ($arr[0] = 2));
// Ранее: int(4), Теперь: int(3)
?>
```

Це робить поведінку посилань і без узгоджених посилань. Зверніть увагу, що читання та запис значення всередині одного виразу залишається невизначеною поведінкою та може змінитися у майбутньому.

#### Розпакування аргументу зі значенням Traversable з нечисловими ключами більше не підтримується

Розпакування аргументів перестало працювати зі значенням [Traversable](class.traversable.html) із нечисловими ключами. Наступний код працює в PHP 5.6-7.2 помилково.

```php
<?php
function foo(...$args) {
    var_dump($args);
}
function gen() {
    yield 1.23 => 123;
}
foo(...gen());
?>
```

#### Різне

Утиліта extskel була повністю перероблена із новими опціями, а деякі старі опції видалені. Тепер вона написана на PHP та не має зовнішніх залежностей.

Підтримку BeOS було припинено.

Винятки, викинуті через автоматичне перетворення попереджень у виключення у режимі `EH_THROW` (наприклад, деякі винятки [DateTime](class.datetime.html)), більше не заповнюють стан [errorgetlast()](function.error-get-last.html). Таким чином, вони тепер працюють так само, як викинуті винятки вручну.

Виняток [TypeError](class.typeerror.html) тепер вказує на правильні типи `int` і `bool` замість `integer` і `boolean`відповідно.

Про невизначені змінні, передані в [compact()](function.compact.html), тепер буде повідомлено повідомленням.

Функція [getimagesize()](function.getimagesize.html) і пов'язані з нею функції тепер повідомляють mime-типи зображень BMP як `image/bmp` замість `image/x-ms-bmp`оскільки перший зареєстрований в IANA (дивіться [» RFC 7903](http://www.faqs.org/rfcs/rfc7903)

Функція [streamsocketgetname()](function.stream-socket-get-name.html) тепер повертає адреси IPv6, укладені у квадратні дужки. Наприклад, буде повернуто рядок `"[::1]:1337"` замість `"::1:1337"`

### Довільної точності математика BCMath

Усі попередження, викинуті [функциями BCMath](ref.bc.html)Тепер використовують обробку помилок PHP. Раніше деякі попередження були надіслані безпосередньо в потік stderr.

Функції [bcmul()](function.bcmul.html) і [bcpow()](function.bcpow.html) тепер повертають числа із запитаним масштабом. Раніше числа, що поверталися, могли опускати завершальні десяткові нулі.

### IMAP, POP3 та NNTP

Логіни **rsh\*\*\*\*ssh** за замовчуванням вимкнено. Використовуйте [imap.enableinsecurersh](imap.configuration.html#ini.imap.enable-insecure-rsh)якщо ви хочете включити їх. Зверніть увагу, що бібліотека IMAP не фільтрує імена поштових скриньок перед передачею їх команді **rsh\*\*\*\*ssh**, таким чином, передача ненадійних даних цієї функції із включеним **rsh\*\*\*\*ssh** небезпечна.

### Мультибайтові рядки

Через додаткову підтримку іменованих фрагментів, патерни `mb_ereg_*()` з використанням іменованих фрагментів будуть поводитися по-різному. Зокрема, іменовані фрагменти будуть частиною збігів, а [мбeregreplace()](function.mb-ereg-replace.html) інтерпретуватиме додатковий синтаксис. Дивіться [Именованные фрагменты](migration73.new-features.html#migration73.new-features.mbstring.named-captures) для отримання додаткової інформації.

### Поліпшений модуль MySQL

Підготовлені запити тепер правильно вказують на дрібні секунди для стовпців `DATETIME` `TIME` і `TIMESTAMP` із вказівником десяткових знаків (наприклад, `TIMESTAMP(6)` при використанні мікросекунд). Раніше частина дробових секунд була просто опущена з значень, що повертаються.

### Функції MySQL (PDOMYSQL)

Підготовлені запити тепер правильно вказують на дрібні секунди для стовпців `DATETIME` `TIME` і `TIMESTAMP` зі специфікатором десяткових знаків (наприклад, `TIMESTAMP(6)` при використанні мікросекунд). Раніше, дробова частина секунд була просто опущена з значень, що повертаються. Зверніть увагу, що це впливає лише на використання [PDOMYSQL](ref.pdo-mysql.html) з відключеною емуляцією підготовлених запитів (наприклад, з використанням нативної функціональності). Запити, які використовують з'єднання, які мають опцію **`PDO::ATTR_EMULATE_PREPARES``true`** (значення за умовчанням), були порушені даним виправленням помилки і вже отримували коректні значення часткою секунди від движка.

### Reflection

Експорт об'єктів [Reflection](book.reflection.html) у рядок тепер використовує `int`) та `bool`) замість `integer` and `boolean`відповідно.

### Стандартна бібліотека PHP (SPL)

Якщо автозавантажувач [SPL](book.spl.html) викидає виняток, наступні автозавантажувачі не виконуватимуться. Раніше всі автозавантажувачі виконувались, а винятки об'єднувалися в ланцюжок викликів.

### SimpleXML

Математичні операції, що включають об'єкти [SimpleXML](book.simplexml.html)Тепер будуть обробляти текст як ціле число (int) або число з плаваючою точкою (float), залежно від того, що є більш відповідним. Раніше значення оброблялися як цілі числа без будь-яких умов.

### Вхідні Cookies

Починаючи з PHP 7.3.23 *імена* вхідні cookie більше не декодуються з URL-закодованого рядка з міркувань безпеки.